<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>屿间导航</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 添加字体库 -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Playfair+Display:wght@700&family=Roboto:wght@400;700&family=Montserrat:wght@700&family=ZCOOL+QingKe+HuangYou&family=Ma+Shan+Zheng&family=Liu+Jian+Mao+Cao&family=Noto+Sans+SC:wght@300;400;500&family=Long+Cang&family=ZCOOL+XiaoWei&family=Caveat:wght@700&family=Shadows+Into+Light&family=Fredericka+the+Great&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-color: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --category-color: #ffffff;
            --bookmark-color: #ffffff;
            --title-font: "Pacifico", cursive;
            --subtitle-font: "'Long Cang', cursive";
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            transition: background 0.5s ease, color 0.5s ease;
            padding: 20px;
            position: relative;
            padding-bottom: 100px;
        }

        /* --- 调整版：细腻复古纸张纹理 --- */
        .texture-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            
            /* 关键修改：baseFrequency 从 0.05 改为 0.25 */
            /* 原理：数值越大，噪点越小，纹理越细腻 */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='crumple'%3E%3CfeTurbulence type='turbulence' baseFrequency='0.12' numOctaves='5' stitchTiles='stitch'/%3E%3CfeDiffuseLighting lighting-color='white' surfaceScale='1.5'%3E%3CfeDistantLight azimuth='45' elevation='60'/%3E%3C/feDiffuseLighting%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23crumple)' opacity='1'/%3E%3C/svg%3E");
            
            mix-blend-mode: overlay;
            
            /* 纹理变细腻后，稍微降低透明度，防止画面显脏 */
            opacity: 0.1; 
            
            backdrop-filter: none;
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
            opacity: 1;
        }

        .container {
            max-width: 1250px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            padding-top: 13%;
            padding-left: 0;
            padding-right: 0;
        }

        /* 标题样式 */
        .header {
            text-align: center;
            padding: 10px 0 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 130px;
            margin-bottom: 10px;
        }

        .page-title-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin-bottom: 10px;
        }

        .page-title {
            font-size: 3.2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px var(--shadow-color);
            font-weight: 700;
            padding: 10px 20px;
            border-radius: 12px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            color: var(--text-color);
            font-family: var(--title-font);
            line-height: 1.2;
        }

        .page-title:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .page-subtitle {
            font-size: 1.6rem;
            color: rgba(255, 255, 255, 0.85);
            font-family: var(--subtitle-font);
            font-weight: 300;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            line-height: 1.5;
            margin-top: 5px;
        }

        .page-title-icon {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            vertical-align: middle;
            border-radius: 10px;
            object-fit: cover;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .page-title-icon.empty {
            display: none;
        }

        /* 搜索框样式 */
        .search-container {
            max-width: 1250px;
            margin: 0 auto 25px;
            position: relative;
            z-index: 10;
            padding-left: 0;
            padding-right: 0;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
        }

        .search-engine-selector {
            position: relative;
            min-width: 60px;
            z-index: 100;
        }

        .current-engine {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: 500;
            width: 60px;
        }

        .current-engine:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* 修复百度图标 - 缩小尺寸并居中 */
        .current-engine .baidu-icon {
            width: 26px; /* 增大尺寸 */
            height: 26px; /* 增大尺寸 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024'%3E%3Cpath fill='%232932e1' d='M407.36 356.8c-36.48 0-68.8 9.6-95.68 29.12-25.6 18.56-45.44 44.8-58.88 77.12-16 38.4-18.56 81.92-11.52 127.36 8.96 57.6 33.92 98.56 73.6 122.24 40.96 24.96 95.68 23.68 158.72-7.04 46.08-22.4 84.48-51.84 114.56-87.36 14.08-16.64 26.88-34.56 39.04-53.12-25.6-39.04-54.4-73.6-86.4-103.68-33.28-31.36-72.32-57.6-116.48-77.12-15.36-6.72-31.36-11.52-48-14.72z'/%3E%3Cpath fill='%2318a2f2' d='M818.56 617.6c-20.48-44.8-44.8-87.36-72.96-127.36-29.44-41.6-63.36-79.36-101.76-113.28-9.6-8.32-19.84-16.64-30.72-24.96-6.72-5.12-13.44-10.24-20.48-15.36-2.56-1.28-5.12-2.56-8.32-3.84-17.92-10.24-36.48-19.2-55.68-27.52-18.56-7.68-38.4-14.08.58.88-19.2-12.8-3.2-26.24-5.76-39.68-7.68-14.08-2.56-28.16-4.48-42.88-5.12-10.24-0.64-20.48-0.64-31.36-0.64h-4.48c-10.24 0-20.48 0-31.36 0.64-14.72 0.64-28.8 2.56-42.88 5.12-13.44 1.92-26.88 4.48-39.68 7.68-20.48 5.12-40.32 11.52-58.88 19.2-19.2 8.32-37.76 17.28-55.68 27.52-3.2 1.28-5.76 2.56-8.32 3.84-7.04 5.12-13.44 10.24-20.48 15.36-10.88 8.32-21.12 16.64-30.72 24.96-38.4 33.92-72.32 71.68-101.76 113.28-28.16 40-52.48 82.56-72.96 127.36-15.36 33.28-28.8 68.48-40.32 105.6h437.12v-0.64c0-32 25.6-57.6 57.6-57.6s57.6 25.6 57.6 57.6v0.64h437.12c-11.52-37.12-24.96-72.32-40.32-105.6z'/%3E%3Cpath fill='%23f05538' d='M818.56 617.6c20.48-44.8 44.8-87.36 72.96-127.36 29.44-41.6 63.36-79.36 101.76-113.28 9.6-8.32 19.84-16.64 30.72-24.96 6.72-5.12 13.44-10.24 20.48-15.36 2.56-1.28 5.12-2.56 8.32-3.84 17.92-10.24 36.48-19.2 55.68-27.52 18.56-7.68 38.4-14.08 58.88-19.2 12.8-3.2 26.24-5.76 39.68-7.68 14.08-2.56 28.16-4.48 42.88-5.12 10.24-0.64 20.48-0.64 31.36-0.64h4.48c10.24 0 20.48 0 31.36 0.64 14.72 0.64 28.8 2.56 42.88 5.12 13.44 1.92 26.88 4.48 39.68 7.68 20.48 5.12 40.32 11.52 58.88 19.2 19.2 8.32 37.76 17.28 55.68 27.52 3.2 1.28 5.76 2.56 8.32 3.84 7.04 5.12 13.44 10.24 20.48 15.36 10.88 8.32 21.12 16.64 30.72 24.96 38.4 33.92 72.32 71.68 101.76 113.28 28.16 40 52.48 82.56 72.96 127.36 15.36 33.28 28.8 68.48 40.32 105.6h-437.12v-0.64c0-32-25.6-57.6-57.6-57.6s-57.6 25.6-57.6 57.6v0.64h-437.12c11.52-37.12 24.96-72.32 40.32-105.6z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .current-engine:hover .baidu-icon {
            filter: brightness(1.2);
        }

        .engine-grid.show .baidu-icon {
            width: 24px; /* 增大网格中的百度图标 */
            height: 24px;
        }

        /* 增大所有搜索引擎图标 */
        .current-engine i {
            font-size: 26px; /* 增大图标 */
        }

        .engine-grid-item i {
            font-size: 28px; /* 增大网格图标 */
        }

        /* 搜索引擎网格样式 */
        .engine-grid {
            position: absolute;
            top: 100%;
            left: 0;
            width: 400px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-top: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            display: none;
            z-index: 1000;
            color: #333;
            padding: 15px;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .engine-grid.show {
            display: grid;
        }

        .engine-grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            text-align: center;
            min-height: 70px;
        }

        .engine-grid-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .engine-grid-icon {
            font-size: 28px; /* 增大图标 */
            margin-bottom: 5px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .engine-grid-name {
            font-size: 12px;
            line-height: 1.3;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background: transparent;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-input.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 识图按钮样式 */
        .image-search-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-right: 8px;
            font-size: 16px;
        }

        .image-search-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .image-search-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .search-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 46px;
            height: 46px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-right: 3px;
        }

        .search-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .search-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* 分类按钮样式 - 修复显示问题 */
        .categories-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            position: relative;
            min-height: 50px;
            padding-left: 0;
            width: 100%;
            overflow: visible;
        }

        .category-item {
            position: relative;
            cursor: move;
        }

        .category-item.dragging {
            opacity: 0.5;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        /* 增大分类按钮字体和间距 */
        .category-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: var(--category-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
            position: relative;
            display: inline-block;
            white-space: nowrap;
        }

        .category-btn.active,
        .category-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .category-btn.active {
            color: var(--category-color);
            border-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        /* 添加分类按钮 */
        .add-category-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.4);
            color: rgba(255, 255, 255, 0.8);
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
            display: none;
            white-space: nowrap;
        }

        .edit-mode .add-category-btn {
            display: inline-block;
        }

        .add-category-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.6);
        }

        /* 分类编辑按钮 - 修复样式 */
        .category-edit-buttons {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 5px;
            z-index: 10;
        }

        .edit-mode .category-edit-buttons {
            display: flex;
        }

        /* 编辑按钮样式 - 改为无框白色图标 */
        .edit-btn-small {
            background: none !important;
            border: none !important;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white !important;
            transition: all 0.2s;
            padding: 0;
            margin: 0;
        }

        .edit-btn-small:hover {
            background: rgba(255, 255, 255, 0.3) !important;
            transform: scale(1.1);
        }

        /* 网站网格样式 */
        .bookmarks-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .bookmarks-section.active {
            display: block;
        }

        /* 增加行与行之间的间距 */
        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .edit-mode .bookmarks-grid {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
        }

        .bookmark-item {
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--bookmark-color);
            min-height: 52px;
            padding: 10px 12px;
            border-radius: 10px;
            text-decoration: none;
            width: 165px;
            overflow: hidden;
        }

        .bookmark-item.dragging {
            opacity: 0.5;
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px dashed rgba(255, 255, 255, 0.5);
            z-index: 100;
        }

        .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .empty-slot {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .edit-mode .empty-slot {
            opacity: 0.3;
            visibility: visible;
            pointer-events: auto;
        }

        .bookmark-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .bookmark-icon-img {
            width: 30px;
            height: 30px;
            object-fit: contain;
            border-radius: 6px;
        }

        .fallback-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
        }

        /* 增大网站按钮字体 */
        .bookmark-name {
            font-size: 14px;
            flex: 1;
            text-align: left;
            word-break: break-all;
            line-height: 1.2;
            font-weight: 500;
            overflow: hidden;
            max-height: 40px;
            min-height: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            white-space: nowrap;
            text-overflow: clip !important;
            max-width: 6.2em !important;
        }

        .bookmark-edit-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            width: 22px;
            height: 22px;
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.2s;
            z-index: 5;
        }

        .edit-mode .bookmark-edit-btn {
            display: flex;
        }

        .bookmark-edit-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.1);
        }

        /* 添加行按钮 */
        .add-row-btn {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
            justify-content: center;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            margin-top: 10px;
        }

        .edit-mode .add-row-btn {
            display: flex;
        }

        .add-row-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* 删除行按钮 */
        .remove-row-btn {
            grid-column: 1 / -1;
            background: rgba(255, 107, 107, 0.1);
            border: 1px dashed rgba(255, 107, 107, 0.3);
            color: rgba(255, 107, 107, 0.7);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
            justify-content: center;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            margin-top: 6px;
        }

        .edit-mode .remove-row-btn {
            display: flex;
        }

        /* 右下角设置按钮 */
        .settings-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(30deg);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .settings-btn.confirm-mode {
            background: rgba(76, 175, 80, 0.8) !important;
            border-color: rgba(76, 175, 80, 0.9) !important;
        }

        .settings-btn.confirm-mode:hover {
            background: rgba(76, 175, 80, 0.9) !important;
        }

        /* 设置菜单 */
        .settings-menu {
            position: fixed;
            bottom: 90px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 200px;
            z-index: 100;
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .settings-menu.show {
            display: flex;
        }

        .settings-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 14px;
            color: #333;
            text-decoration: none;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .settings-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* 配色和背景模态框 - 加宽 */
        .color-bg-modal-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 30px;
            width: 95%;
            max-width: 1000px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
            max-height: 85vh;
            overflow-y: auto;
        }

        .color-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .color-tab {
            padding: 8px 16px;
            border: none;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .color-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .color-tab:hover:not(.active) {
            background: #e0e0e0;
        }

        .color-tab-content {
            display: none;
        }

        .color-tab-content.active {
            display: block;
        }

        /* 皮肤网格 */
        .skin-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .skin-item {
            background: #f5f5f5;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .skin-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .skin-item.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .skin-preview {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .skin-name {
            padding: 10px;
            text-align: center;
            background: white;
            font-size: 14px;
            font-weight: 500;
        }

        /* 颜色选择器 */
        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .color-label {
            min-width: 100px;
            font-weight: 500;
        }

        .custom-color-input {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
            overflow: hidden;
        }

        .custom-color-input::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .custom-color-input::-webkit-color-swatch {
            border: none;
        }

        .color-value {
            font-size: 14px;
            color: #666;
            min-width: 70px;
        }

        /* 壁纸选项 */
        .bg-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .bg-option {
            height: 80px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            overflow: hidden;
            position: relative;
        }

        .bg-option:hover {
            transform: scale(1.05);
        }

        .bg-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.8);
        }

        .bg-option-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* 新增：数据文本域样式 */
        .data-textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .data-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* 错误提示样式 */
        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* 图标选择器样式 */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.1);
        }

        .icon-option:hover {
            background: rgba(102, 126, 234, 0.8);
            transform: scale(1.1);
        }

        .icon-option.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        /* 拖拽提示 */
        .drag-hint {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        .edit-mode .drag-hint {
            display: block;
        }

        /* 字体选择器样式 - 重新设计为每行5个，四行不滚动 */
        .font-selector-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
            max-height: none;
            overflow: visible;
        }

        .font-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .font-type-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        .font-type-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .font-selector-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .font-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 5px;
            max-height: none;
            overflow-y: visible;
            padding: 5px;
        }

        .font-option {
            padding: 10px 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            text-align: center;
            background: rgba(0, 0, 0, 0.05);
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
        }

        .font-option:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.05);
        }

        .font-option.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        /* 标题图标预览 */
        .title-icon-preview {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            margin: 10px auto;
            display: block;
            border: 2px solid #ddd;
        }

        /* 图片搜索模态框样式 */
        .image-search-modal-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
            max-height: 90vh;
            overflow-y: auto;
        }

        .image-upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            background: #f9f9f9;
        }

        .image-upload-area:hover {
            border-color: var(--primary-color);
            background: #f0f0f0;
        }

        .image-upload-area.dragover {
            border-color: var(--primary-color);
            background: #e8f0fe;
        }

        .image-upload-icon {
            font-size: 48px;
            color: #666;
            margin-bottom: 15px;
        }

        .image-preview-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .image-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: none;
        }

        .image-search-engines {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .image-search-engine {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            background: #f5f5f5;
        }

        .image-search-engine:hover {
            background: #e8e8e8;
            transform: translateY(-2px);
        }

        .image-search-engine.selected {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .image-search-engine-icon {
            font-size: 24px;
            margin-bottom: 8px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-search-engine-name {
            font-size: 12px;
            font-weight: 500;
        }

        .image-search-url-input {
            margin-top: 15px;
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes dragPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .dragging-pulse {
            animation: dragPulse 1s infinite;
        }

        /* 新增：管理行数确认对话框 */
        .confirm-dialog {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
            text-align: center;
        }

        .confirm-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .confirm-message {
            font-size: 1rem;
            margin-bottom: 20px;
            color: #666;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* 导入选项样式 */
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .import-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.2s;
        }

        .import-option:hover {
            background: #e8e8e8;
        }

        .import-option.selected {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .import-option input[type="radio"] {
            margin: 0;
        }

        .import-option-label {
            flex: 1;
        }

        .import-option-desc {
            font-size: 12px;
            color: #666;
        }

        /* 字体大小调节容器 */
        .font-size-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .font-size-slider-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .font-size-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        .font-size-value {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            min-width: 40px;
            text-align: right;
        }

        /* 拖拽增强效果 */
        .category-item.drag-over {
            border: 2px solid var(--primary-color) !important;
            background: rgba(102, 126, 234, 0.1) !important;
            transform: scale(1.05) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
        }

        .bookmark-item.drag-over {
            border: 2px solid var(--primary-color) !important;
            background: rgba(102, 126, 234, 0.1) !important;
            transform: scale(1.05) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
        }

        .category-drag-placeholder {
            border: 2px dashed var(--primary-color);
            border-radius: 25px;
            background: rgba(102, 126, 234, 0.05);
            height: 42px;
            margin: 0 12px;
            transition: all 0.3s;
        }

        .bookmark-drag-placeholder {
            border: 2px dashed var(--primary-color);
            border-radius: 10px;
            background: rgba(102, 126, 234, 0.05);
            height: 52px;
            width: 165px;
            margin: 0 10px;
            transition: all 0.3s;
        }

        /* 手机端优化 */
        @media (max-width: 768px) {
            .search-box {
                flex-direction: row;
                border-radius: 15px;
                padding: 5px;
                flex-wrap: nowrap;
            }
            
            .search-engine-selector {
                width: auto;
                margin-bottom: 0;
                min-width: 60px;
            }
            
            .search-input {
                width: auto;
                margin-bottom: 0;
                flex: 1;
                font-size: 14px;
            }
            
            /* 手机端隐藏搜索框占位符文字 */
            .search-input::placeholder {
                color: transparent;
            }
            
            .search-input:focus::placeholder {
                color: transparent;
            }
            
            .search-btn {
                width: 40px;
                height: 40px;
                margin-right: 0;
            }

            .image-search-btn {
                width: 36px;
                height: 36px;
                margin-right: 6px;
                font-size: 14px;
            }
            
            .current-engine {
                width: 50px;
                padding: 8px 10px;
            }
            
            .engine-grid {
                width: 250px;
                grid-template-columns: repeat(2, 1fr);
                left: 50%;
                transform: translateX(-50%);
            }
            
            .bookmarks-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .categories-container {
                gap: 8px;
            }
            
            .category-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .font-selector {
                grid-template-columns: repeat(3, 1fr);
            }

            .image-search-engines {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .bookmarks-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .engine-grid {
                width: 350px;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .icon-selector {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .skin-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .font-selector {
                grid-template-columns: repeat(4, 1fr);
            }

            .image-search-engines {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 992px) {
            .bookmarks-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .page-title {
                font-size: 2.5rem;
            }
            
            .engine-grid {
                width: 300px;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .icon-selector {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .skin-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bg-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .font-selector {
                grid-template-columns: repeat(3, 1fr);
            }

            .image-search-engines {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .bookmarks-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .settings-menu {
                right: 15px;
                bottom: 80px;
            }
            
            .icon-selector {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .skin-grid {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .bg-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .font-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .image-search-engines {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .bookmarks-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .page-subtitle {
                font-size: 0.9rem;
                padding: 0 15px;
            }
            
            .engine-grid {
                width: 200px;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .icon-selector {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .skin-grid {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .bg-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* 手机端进一步优化 */
            .search-box {
                padding: 3px;
            }
            
            .search-input {
                font-size: 12px;
                padding: 8px 10px;
            }
            
            .current-engine {
                width: 45px;
                padding: 6px 8px;
            }
            
            .search-engine-selector {
                min-width: 45px;
            }
            
            .engine-grid {
                width: 180px;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .category-btn {
                padding: 6px 14px;
                font-size: 13px;
            }
            
            .font-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .image-search-engines {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 优化字体输入框 */
        .title-input-short {
            width: 100%;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- 纹理层 -->
    <div class="texture-layer"></div>
    
    <!-- 背景图片 -->
    <img class="background-image" id="backgroundImage" src="" alt="背景">
    
    <div class="container" id="mainContainer">
        <!-- 标题 -->
        <div class="header">
            <div class="page-title-container">
                <h1 class="page-title" id="pageTitle"></h1>
            </div>
            <div class="page-subtitle" id="pageSubtitle">
                每一次与过往照面，都是为了与未来更好地遇见。
            </div>
        </div>
        
        <!-- 搜索框 -->
        <div class="search-container">
            <div class="search-box">
                <div class="search-engine-selector">
                    <div class="current-engine" id="currentEngine">
                        <i class="fab fa-google"></i>
                        <span class="engine-name" style="display: none;">谷歌</span>
                    </div>
                    <div class="engine-grid" id="engineGrid">
                        <!-- 搜索引擎将通过JS动态生成 -->
                    </div>
                </div>
                <input type="text" class="search-input" id="searchInput" placeholder="输入搜索内容或网址...">
                <!-- 识图按钮 -->
                <button class="image-search-btn" id="imageSearchBtn" title="识图搜图">
                    <i class="fas fa-camera"></i>
                </button>
                <button class="search-btn" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        
        <!-- 分类标签 -->
        <div class="categories-container" id="categoriesContainer">
            <!-- 分类按钮将通过JS动态生成 -->
        </div>
        
        <!-- 拖拽提示 -->
        <div class="drag-hint" id="dragHint">
            <i class="fas fa-arrows-alt"></i> 拖拽分类或网站可以调整顺序
        </div>
        
        <!-- 网站内容区域 -->
        <div id="bookmarksContainer">
            <!-- 网站将通过JS动态生成 -->
        </div>
    </div>
    
    <!-- 右下角设置按钮 -->
    <button class="settings-btn" id="settingsBtn">
        <i class="fas fa-cog"></i>
    </button>
    
    <!-- 设置菜单 -->
    <div class="settings-menu" id="settingsMenu">
        <button class="settings-item" id="customizeBtn">
            <i class="fas fa-sliders-h"></i> 自定义模式
        </button>
        <button class="settings-item" id="colorBgBtn">
            <i class="fas fa-palette"></i> 配色与背景
        </button>
        <button class="settings-item" id="importExportBtn">
            <i class="fas fa-file-export"></i> 数据备份与恢复
        </button>
        <button class="settings-item" id="resetBtn">
            <i class="fas fa-redo"></i> 恢复默认
        </button>
    </div>
    
    <!-- 图片搜索模态框 -->
    <div class="modal" id="imageSearchModal">
        <div class="modal-content image-search-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">识图搜图</h2>
                <button class="close-modal" id="closeImageSearchModalBtn">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">上传图片</label>
                <div class="image-upload-area" id="imageUploadArea">
                    <div class="image-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p>点击选择图片，或拖拽图片到这里</p>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">支持 JPG、PNG、GIF 格式</p>
                </div>
                <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">
                
                <div class="image-preview-container">
                    <img id="imagePreview" class="image-preview" alt="图片预览">
                </div>
                
                <div class="form-group">
                    <label class="form-label">或输入图片URL</label>
                    <input type="text" class="form-input" id="imageUrlInput" placeholder="https://example.com/image.jpg">
                </div>
                
                <div class="form-group">
                    <label class="form-label">选择搜图引擎</label>
                    <div class="image-search-engines" id="imageSearchEngines">
                        <!-- 搜图引擎将通过JS动态生成 -->
                    </div>
                </div>
                
                <div class="error-message" id="imageSearchError"></div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelImageSearchBtn">取消</button>
                <button type="button" class="btn btn-primary" id="startImageSearchBtn" disabled>开始搜图</button>
            </div>
        </div>
    </div>
    
    <!-- 编辑网站模态框 -->
    <div class="modal" id="editBookmarkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">编辑网站</h2>
                <button class="close-modal" id="closeEditModalBtn">&times;</button>
            </div>
            <form id="editBookmarkForm">
                <div class="form-group">
                    <label class="form-label" for="editBookmarkName">网站名称 (最多10个字符)</label>
                    <input type="text" class="form-input" id="editBookmarkName" required maxlength="10">
                    <small style="color: #666; display: block; margin-top: 5px;">提示：最多显示8个汉字长度，完整名称可在鼠标悬停时查看</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editBookmarkUrl">网站地址 (URL)</label>
                    <input type="text" class="form-input" id="editBookmarkUrl" required placeholder="https://example.com">
                    <small style="color: #666; display: block; margin-top: 5px;">提示：请输入完整的URL地址，如 https://www.google.com</small>
                </div>
                <div class="form-group">
                    <label class="form-label">选择图标</label>
                    <div class="icon-selector" id="iconSelector">
                        <!-- 图标将通过JS动态生成 -->
                    </div>
                    <small style="color: #666; display: block; margin-top: 5px;">提示：选择网站图标，如无法获取网站图标将使用此图标</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditBtn">取消</button>
                    <button type="submit" class="btn btn-primary" id="saveEditBtn">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 编辑分类模态框 -->
    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">编辑分类</h2>
                <button class="close-modal" id="closeCategoryModalBtn">&times;</button>
            </div>
            <form id="editCategoryForm">
                <div class="form-group">
                    <label class="form-label" for="editCategoryName">分类名称</label>
                    <input type="text" class="form-input" id="editCategoryName" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelCategoryEditBtn">取消</button>
                    <button type="submit" class="btn btn-primary" id="saveCategoryEditBtn">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 添加分类模态框 -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">添加分类</h2>
                <button class="close-modal" id="closeAddCategoryModalBtn">&times;</button>
            </div>
            <form id="addCategoryForm">
                <div class="form-group">
                    <label class="form-label" for="addCategoryName">分类名称</label>
                    <input type="text" class="form-input" id="addCategoryName" required placeholder="请输入新分类名称">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelAddCategoryBtn">取消</button>
                    <button type="submit" class="btn btn-primary" id="saveAddCategoryBtn">添加</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 配色和背景模态框 -->
    <div class="modal" id="colorBgModal">
        <div class="modal-content color-bg-modal-content" style="max-width: 1200px !important; width: 90% !important;">
            <div class="modal-header">
                <h2 class="modal-title">配色与背景</h2>
                <button class="close-modal" id="closeColorBgModalBtn">&times;</button>
            </div>
            
            <div class="color-tabs">
                <button class="color-tab active" data-tab="skins">皮肤</button>
                <button class="color-tab" data-tab="colors">颜色</button>
                <button class="color-tab" data-tab="background">背景</button>
                <button class="color-tab" data-tab="fonts">字体与标题</button>
            </div>
            
            <!-- 皮肤标签页 -->
            <div class="color-tab-content active" id="skinsTab">
                <div class="form-group">
                    <label class="form-label">选择预设皮肤</label>
                    <div class="skin-grid" id="skinGrid">
                        <!-- 皮肤将通过JS动态生成 -->
                    </div>
                    <small style="color: #666; display: block; margin-top: 10px;">提示：切换皮肤只会改变外观，不会影响您的自定义设置</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelSkinBtn">取消</button>
                    <button type="button" class="btn btn-primary" id="applySkinBtn">应用皮肤</button>
                </div>
            </div>
            
            <!-- 颜色标签页 -->
            <div class="color-tab-content" id="colorsTab">
                <div class="form-group">
                    <label class="form-label">自定义颜色</label>
                    
                    <div class="color-picker-container">
                        <span class="color-label">标题颜色</span>
                        <input type="color" class="custom-color-input" id="titleColorPicker" value="#ffffff">
                        <span class="color-value" id="titleColorValue">#FFFFFF</span>
                    </div>
                    
                    <div class="color-picker-container">
                        <span class="color-label">分类颜色</span>
                        <input type="color" class="custom-color-input" id="categoryColorPicker" value="#ffffff">
                        <span class="color-value" id="categoryColorValue">#FFFFFF</span>
                    </div>
                    
                    <div class="color-picker-container">
                        <span class="color-label">网站颜色</span>
                        <input type="color" class="custom-color-input" id="bookmarkColorPicker" value="#ffffff">
                        <span class="color-value" id="bookmarkColorValue">#FFFFFF</span>
                    </div>
                    
                    <div class="color-picker-container">
                        <span class="color-label">主色调</span>
                        <input type="color" class="custom-color-input" id="primaryColorPicker" value="#667eea">
                        <span class="color-value" id="primaryColorValue">#667EEA</span>
                    </div>
                    
                    <div class="color-picker-container">
                        <span class="color-label">副色调</span>
                        <input type="color" class="custom-color-input" id="secondaryColorPicker" value="#764ba2">
                        <span class="color-value" id="secondaryColorValue">#764BA2</span>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelColorsBtn">取消</button>
                    <button type="button" class="btn btn-primary" id="applyColorsBtn">应用颜色</button>
                </div>
            </div>
            
            <!-- 背景标签页 -->
            <div class="color-tab-content" id="backgroundTab">
                <div class="form-group">
                    <label class="form-label">选择背景类型</label>
                    <div class="bg-options">
                        <div class="bg-option" id="gradient1" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="bg-option-text">渐变1</div>
                        </div>
                        <div class="bg-option" id="gradient2" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="bg-option-text">渐变2</div>
                        </div>
                        <div class="bg-option" id="gradient3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="bg-option-text">渐变3</div>
                        </div>
                        <div class="bg-option" id="gradient4" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <div class="bg-option-text">渐变4</div>
                        </div>
                        <div class="bg-option" id="gradient5" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <div class="bg-option-text">渐变5</div>
                        </div>
                        <div class="bg-option" id="imageUpload">
                            <div class="bg-option-text" style="color: #333;">
                                <i class="fas fa-upload"></i> 上传图片
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">上传自定义图片 (支持4K高清壁纸)</label>
                    <input type="file" class="form-input" id="imageUploadInput" accept="image/*">
                    <div class="error-message" id="imageError"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelBgBtn">取消</button>
                    <button type="button" class="btn btn-primary" id="applyBgBtn">应用背景</button>
                </div>
            </div>
            
            <!-- 字体与标题标签页 - 重新设计布局 -->
            <div class="color-tab-content" id="fontsTab">
                <div class="form-group">
                    <label class="form-label">标题文字</label>
                    <input type="text" class="form-input title-input-short" id="editTitleText" placeholder="请输入导航页标题" style="max-width: 300px;">
                    <small style="color: #666; display: block; margin-top: 5px;">提示：留空可删除标题文字</small>
                </div>
                <div class="form-group">
                    <label class="form-label">副标题文字</label>
                    <input type="text" class="form-input title-input-short" id="editSubtitleText" placeholder="请输入副标题" style="max-width: 300px;">
                    <small style="color: #666; display: block; margin-top: 5px;">提示：留空可删除副标题文字</small>
                </div>
                <div class="form-group">
                    <label class="form-label">标题图标</label>
                    <div style="text-align: center;">
                        <img id="titleIconPreview" class="title-icon-preview" src="" alt="图标预览" style="display: none;">
                    </div>
                    <input type="file" class="form-input" id="titleIconUpload" accept="image/*" style="margin-bottom: 10px;">
                    <button type="button" class="btn btn-secondary" id="removeTitleIconBtn" style="width: 100%; margin-bottom: 20px;">移除图标</button>
                </div>
                
                <!-- 字体大小调节 - 紧凑布局 -->
                <div class="font-size-container">
                    <div class="font-size-slider-container">
                        <div class="font-size-label">
                            <span>主标题大小</span>
                            <span class="font-size-value" id="titleFontSizeValue">48px</span>
                        </div>
                        <input type="range" class="form-input" id="titleFontSize" min="24" max="80" step="2" value="48" style="width: 100%;">
                    </div>
                    <div class="font-size-slider-container">
                        <div class="font-size-label">
                            <span>副标题大小</span>
                            <span class="font-size-value" id="subtitleFontSizeValue">24px</span>
                        </div>
                        <input type="range" class="form-input" id="subtitleFontSize" min="12" max="48" step="2" value="24" style="width: 100%;">
                    </div>
                </div>
                
                <!-- 字体选择器部分 - 重新设计 -->
                <div class="font-selector-container">
                    <div class="font-type-selector">
                        <button type="button" class="font-type-btn active" id="titleFontTypeBtn">主标题字体</button>
                        <button type="button" class="font-type-btn" id="subtitleFontTypeBtn">副标题字体</button>
                    </div>
                    
                    <div class="font-selector-title">
                        <i class="fas fa-font"></i> 字体选择
                    </div>
                    <div class="font-selector" id="fontSelector">
                        <!-- 字体将通过JS动态生成 -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelFontsBtn">取消</button>
                    <button type="button" class="btn btn-primary" id="applyFontsBtn">应用字体与标题</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 导入导出模态框 - 新增导入选项 -->
    <div class="modal" id="importExportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">数据备份与恢复</h2>
                <button class="close-modal" id="closeImportExportModalBtn">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">导出数据</label>
                <p style="margin-bottom: 10px; color: #666;">点击下方按钮将当前所有数据导出为清晰文本文件</p>
                <button type="button" class="btn btn-primary" id="exportDataBtn" style="width: 100%;">
                    <i class="fas fa-download"></i> 导出数据到TXT文件
                </button>
                <small style="color: #666; display: block; margin-top: 10px;">导出格式：分类名称 + 网站名称 | 网址，方便编辑</small>
            </div>
            <div class="form-group">
                <label class="form-label">导入数据</label>
                <p style="margin-bottom: 10px; color: #666;">将编辑好的TXT文件内容粘贴到下方，或选择文件导入</p>
                
                <!-- 移除文本框，只保留文件上传 -->
                <input type="file" class="form-input" id="importFileInput" accept=".txt" style="margin-bottom: 15px;">
                
                <!-- 新增：导入选项 -->
                <div class="import-options" id="importOptions">
                    <div class="import-option" id="importOptionReplace">
                        <input type="radio" id="importTypeReplace" name="importType" value="replace" checked>
                        <div class="import-option-label">
                            <strong>全部替换</strong>
                            <div class="import-option-desc">清空现有数据，完全替换为导入的数据</div>
                        </div>
                    </div>
                    <div class="import-option" id="importOptionAdd">
                        <input type="radio" id="importTypeAdd" name="importType" value="add">
                        <div class="import-option-label">
                            <strong>增加分类</strong>
                            <div class="import-option-desc">保留现有数据，只添加新的分类和网站</div>
                        </div>
                    </div>
                </div>
                
                <div class="error-message" id="importError"></div>
                <small style="color: #666; display: block; margin-top: 5px;">提示：导入前会自动备份当前数据到"自动备份_当前时间.txt"</small>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelImportExportBtn">取消</button>
                <button type="button" class="btn btn-primary" id="importDataBtn">导入数据</button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div class="modal" id="confirmDialog">
        <div class="confirm-dialog">
            <div class="confirm-title" id="confirmDialogTitle">确认操作</div>
            <div class="confirm-message" id="confirmDialogMessage">您确定要执行此操作吗？</div>
            <div class="confirm-actions">
                <button type="button" class="btn btn-secondary" id="confirmDialogCancelBtn">取消</button>
                <button type="button" class="btn btn-primary" id="confirmDialogConfirmBtn">确认</button>
            </div>
        </div>
    </div>

    <script>
        // 搜索框提示语数组
        const searchPlaceholders = [
            "喂，是直接搜还是走个流程？",
            "告诉我你想翻谁的牌子～",
            "别愣着，敲点字吧！",
            "网址或咒语，速速报来。",
            "知识、八卦、好玩的，我全知道。",
            "您的专属任意门，请输入目的地。",
            "偷偷告诉我，你想搜什么？",
            "开始一场'即搜即走'的旅行。",
            "我准备好了，你呢？",
            "输入任意'愿望'，开始生成。",
            "启动一次关键词穿越。",
            "请输入目的地坐标（或关键词）。",
            "连接你与答案的最近节点。",
            "将你的好奇，编译为地址。",
            "思想发射井，等待指令。",
            "您的大脑外接搜索引擎，已就绪。",
            "从这里，打开下一个标签页。",
            "用几个字，撬动整个网络。",
            "当前路径：未定义。请输入新路径。",
            "问题接收器，正在待命。",
            "指尖所向，山海皆可往。",
            "在此处，投石问路。",
            "让一个词，带你抵达它的辽阔。",
            "心念一动，世界便为你铺路。",
            "方寸之间，自有天地。",
            "所有的远方，都始于此刻的光标。",
            "以词为舟，以网为海。",
            "书写你的下一个'抵达'。",
            "凝神，输入，然后抵达。",
            "每一次回车，都是启程。",
            "愣着干嘛？填它！",
            "知识、八卦、好玩的，我全知道。",
            "您的专属任意门，请输入目的地。",
            "悄悄话模式：你想搜什么？",
            "开始一场'即搜即走'的旅行。",
            "万事俱备，只差你的输入。",
            "输入任意'愿望'，开始生成。",
            "叮！这里接收所有问题。",
            "思想发射井，等待指令。",
            "您的大脑外接搜索引擎，已就绪。",
            "从这里，打开下一个标签页。",
            "用几个字，撬动整个网络。",
            "当前路径：未定义。请输入新路径。",
            "问题接收器，正在待命。",
            "向未知发送一个信号。",
            "启动你的信息火箭。",
            "心念一动，世界便为你铺路。",
            "方寸之间，自有天地。",
            "所有的远方，都始于此刻的光标。",
            "以词为舟，以网为海。",
            "书写你的下一个'抵达'。",
            "凝神，输入，然后抵达。",
            "近来搜得甚妙？",
            "心有一念，此处落键。",
            "但书一字，海内共鸣。",
            "欲叩何方门扉？",
            "忽有所得？书于此。",
            "游目骋怀，以此为棹。",
            "啪！你要搜个什么？",
            "万川映月，一月摄万川。",
            "搜山搜海，不如搜心。",
            "莫问搜否，但管敲来。"
        ];

        // 预设皮肤数据
        const skinPresets = [
            {
                id: 'skin1',
                name: '深邃蓝',
                primaryColor: '#667eea',
                secondaryColor: '#764ba2',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            },
            {
                id: 'skin2',
                name: '梦幻粉',
                primaryColor: '#f093fb',
                secondaryColor: '#f5576c',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            },
            {
                id: 'skin3',
                name: '海洋蓝',
                primaryColor: '#4facfe',
                secondaryColor: '#00f2fe',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            },
            {
                id: 'skin4',
                name: '森林绿',
                primaryColor: '#43e97b',
                secondaryColor: '#38f9d7',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            },
            {
                id: 'skin5',
                name: '落日橙',
                primaryColor: '#fa709a',
                secondaryColor: '#fee140',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                textColor: '#333333',
                categoryColor: '#333333',
                bookmarkColor: '#333333'
            },
            {
                id: 'skin6',
                name: '简约黑',
                primaryColor: '#333333',
                secondaryColor: '#666666',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #333333 0%, #666666 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            },
            {
                id: 'skin7',
                name: '薰衣草',
                primaryColor: '#a8edea',
                secondaryColor: '#fed6e3',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                textColor: '#333333',
                categoryColor: '#333333',
                bookmarkColor: '#333333'
            },
            {
                id: 'skin8',
                name: '纯净白',
                primaryColor: '#f8f9fa',
                secondaryColor: '#e9ecef',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)',
                textColor: '#333333',
                categoryColor: '#333333',
                bookmarkColor: '#333333'
            },
            {
                id: 'skin9',
                name: '星空紫',
                primaryColor: '#6a11cb',
                secondaryColor: '#2575fc',
                bgType: 'gradient',
                bgValue: 'linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff'
            }
        ];

        // 图片搜索引擎数据 - 修正为4个
        const imageSearchEnginesData = {
            baidu: {
                name: '百度识图',
                icon: 'fas fa-paw',
                url: 'https://image.baidu.com/n/pc_search',
                method: 'redirect'
            },
            google: {
                name: '谷歌搜图',
                icon: 'fab fa-google',
                url: 'https://images.google.com/searchbyimage?image_url=',
                method: 'url'
            },
            bing: {
                name: '必应搜图',
                icon: 'fab fa-microsoft',
                url: 'https://www.bing.com/images/search?q=imgurl:',
                method: 'url'
            },
            yandex: {
                name: 'Yandex搜图',
                icon: 'fab fa-yandex',
                url: 'https://yandex.com/images/search?url=',
                method: 'url'
            }
        };

        // 初始数据
        const initialData = {
            categories: [
                { id: 1, name: '影音', order: 1 },
                { id: 2, name: '购物', order: 2 },
                { id: 3, name: '资讯', order: 3 },
                { id: 4, name: '社交', order: 4 },
                { id: 5, name: '生活', order: 5 },
                { id: 6, name: '工具', order: 6 },
                { id: 7, name: '趣站', order: 7 },
                { id: 8, name: '尔联', order: 8 }
            ],
            bookmarks: [
                // 影音分类 - 24个网站
                { id: 1, name: '哔哩哔哩', url: 'https://www.bilibili.com', categoryId: 1, order: 1, customIcon: null },
                { id: 2, name: 'YouTube', url: 'https://www.youtube.com', categoryId: 1, order: 2, customIcon: null },
                { id: 3, name: '爱奇艺', url: 'https://www.iqiyi.com', categoryId: 1, order: 3, customIcon: null },
                { id: 4, name: '腾讯视频', url: 'https://v.qq.com', categoryId: 1, order: 4, customIcon: null },
                { id: 5, name: '优酷', url: 'https://www.youku.com', categoryId: 1, order: 5, customIcon: null },
                { id: 6, name: '芒果TV', url: 'https://www.mgtv.com', categoryId: 1, order: 6, customIcon: null },
                { id: 7, name: '网易云音乐', url: 'https://music.163.com', categoryId: 1, order: 7, customIcon: null },
                { id: 8, name: 'QQ音乐', url: 'https://y.qq.com', categoryId: 1, order: 8, customIcon: null },
                { id: 9, name: '酷狗音乐', url: 'https://www.kugou.com', categoryId: 1, order: 9, customIcon: null },
                { id: 10, name: '酷我音乐', url: 'https://www.kuwo.cn', categoryId: 1, order: 10, customIcon: null },
                { id: 11, name: '咪咕音乐', url: 'https://music.migu.cn', categoryId: 1, order: 11, customIcon: null },
                { id: 12, name: '抖音', url: 'https://www.douyin.com', categoryId: 1, order: 12, customIcon: null },
                { id: 13, name: '快手', url: 'https://www.kuaishou.com', categoryId: 1, order: 13, customIcon: null },
                { id: 14, name: '斗鱼', url: 'https://www.douyu.com', categoryId: 1, order: 14, customIcon: null },
                { id: 15, name: '虎牙直播', url: 'https://www.huya.com', categoryId: 1, order: 15, customIcon: null },
                { id: 16, name: 'AcFun', url: 'https://www.acfun.cn', categoryId: 1, order: 16, customIcon: null },
                { id: 17, name: '西瓜视频', url: 'https://www.ixigua.com', categoryId: 1, order: 17, customIcon: null },
                { id: 18, name: '喜马拉雅', url: 'https://www.ximalaya.com', categoryId: 1, order: 18, customIcon: null },
                { id: 19, name: '蜻蜓FM', url: 'https://www.qingting.fm', categoryId: 1, order: 19, customIcon: null },
                { id: 20, name: '猫耳FM', url: 'https://www.missevan.com', categoryId: 1, order: 20, customIcon: null },
                { id: 21, name: '全民K歌', url: 'https://kg.qq.com', categoryId: 1, order: 21, customIcon: null },
                { id: 22, name: '唱吧', url: 'https://changba.com', categoryId: 1, order: 22, customIcon: null },
                { id: 23, name: '网易LOOK直播', url: 'https://look.163.com', categoryId: 1, order: 23, customIcon: null },
                { id: 24, name: '微光', url: 'https://weiguang.com', categoryId: 1, order: 24, customIcon: null },
                
                // 购物分类 - 24个网站
                { id: 25, name: '淘宝', url: 'https://www.taobao.com', categoryId: 2, order: 1, customIcon: null },
                { id: 26, name: '京东', url: 'https://www.jd.com', categoryId: 2, order: 2, customIcon: null },
                { id: 27, name: '天猫', url: 'https://www.tmall.com', categoryId: 2, order: 3, customIcon: null },
                { id: 28, name: '拼多多', url: 'https://www.pinduoduo.com', categoryId: 2, order: 4, customIcon: null },
                { id: 29, name: '苏宁易购', url: 'https://www.suning.com', categoryId: 2, order: 5, customIcon: null },
                { id: 30, name: '亚马逊', url: 'https://www.amazon.cn', categoryId: 2, order: 6, customIcon: null },
                { id: 31, name: '唯品会', url: 'https://www.vip.com', categoryId: 2, order: 7, customIcon: null },
                { id: 32, name: '考拉海购', url: 'https://www.kaola.com', categoryId: 2, order: 8, customIcon: null },
                { id: 33, name: '当当网', url: 'https://www.dangdang.com', categoryId: 2, order: 9, customIcon: null },
                { id: 34, name: '小米商城', url: 'https://www.mi.com', categoryId: 2, order: 10, customIcon: null },
                { id: 35, name: '华为商城', url: 'https://www.vmall.com', categoryId: 2, order: 11, customIcon: null },
                { id: 36, name: 'Apple官网', url: 'https://www.apple.com/cn', categoryId: 2, order: 12, customIcon: null },
                { id: 37, name: '网易严选', url: 'https://you.163.com', categoryId: 2, order: 13, customIcon: null },
                { id: 38, name: '美团', url: 'https://www.meituan.com', categoryId: 2, order: 14, customIcon: null },
                { id: 39, name: '饿了么', url: 'https://www.ele.me', categoryId: 2, order: 15, customIcon: null },
                { id: 40, name: '大众点评', url: 'https://www.dianping.com', categoryId: 2, order: 16, customIcon: null },
                { id: 41, name: '携程', url: 'https://www.ctrip.com', categoryId: 2, order: 17, customIcon: null },
                { id: 42, name: '飞猪', url: 'https://www.fliggy.com', categoryId: 2, order: 18, customIcon: null },
                { id: 43, name: '去哪儿', url: 'https://www.qunar.com', categoryId: 2, order: 19, customIcon: null },
                { id: 44, name: '马蜂窝', url: 'https://www.mafengwo.cn', categoryId: 2, order: 20, customIcon: null },
                { id: 45, name: '12306', url: 'https://www.12306.cn', categoryId: 2, order: 21, customIcon: null },
                { id: 46, name: '途牛', url: 'https://www.tuniu.com', categoryId: 2, order: 22, customIcon: null },
                { id: 47, name: '同程', url: 'https://www.ly.com', categoryId: 2, order: 23, customIcon: null },
                { id: 48, name: '艺龙', url: 'https://www.elong.com', categoryId: 2, order: 24, customIcon: null },
                
                // 资讯分类 - 24个网站
                { id: 49, name: '今日头条', url: 'https://www.toutiao.com', categoryId: 3, order: 1, customIcon: null },
                { id: 50, name: '新浪新闻', url: 'https://news.sina.com.cn', categoryId: 3, order: 2, customIcon: null },
                { id: 51, name: '腾讯新闻', url: 'https://news.qq.com', categoryId: 3, order: 3, customIcon: null },
                { id: 52, name: '网易新闻', url: 'https://news.163.com', categoryId: 3, order: 4, customIcon: null },
                { id: 53, name: '搜狐新闻', url: 'https://news.sohu.com', categoryId: 3, order: 5, customIcon: null },
                { id: 54, name: '凤凰网', url: 'https://www.ifeng.com', categoryId: 3, order: 6, customIcon: null },
                { id: 55, name: '央视新闻', url: 'https://news.cctv.com', categoryId: 3, order: 7, customIcon: null },
                { id: 56, name: '人民网', url: 'https://www.people.com.cn', categoryId: 3, order: 8, customIcon: null },
                { id: 57, name: '新华网', url: 'https://www.xinhuanet.com', categoryId: 3, order: 9, customIcon: null },
                { id: 58, name: '环球网', url: 'https://www.huanqiu.com', categoryId: 3, order: 10, customIcon: null },
                { id: 59, name: '观察者网', url: 'https://www.guancha.cn', categoryId: 3, order: 11, customIcon: null },
                { id: 60, name: '虎嗅网', url: 'https://www.huxiu.com', categoryId: 3, order: 12, customIcon: null },
                { id: 61, name: '36氪', url: 'https://36kr.com', categoryId: 3, order: 13, customIcon: null },
                { id: 62, name: '界面新闻', url: 'https://www.jiemian.com', categoryId: 3, order: 14, customIcon: null },
                { id: 63, name: '澎湃新闻', url: 'https://www.thepaper.cn', categoryId: 3, order: 15, customIcon: null },
                { id: 64, name: '财新网', url: 'https://www.caixin.com', categoryId: 3, order: 16, customIcon: null },
                { id: 65, name: '第一财经', url: 'https://www.yicai.com', categoryId: 3, order: 17, customIcon: null },
                { id: 66, name: '华尔街见闻', url: 'https://wallstreetcn.com', categoryId: 3, order: 18, customIcon: null },
                { id: 67, name: '雪球', url: 'https://xueqiu.com', categoryId: 3, order: 19, customIcon: null },
                { id: 68, name: '东方财富', url: 'https://www.eastmoney.com', categoryId: 3, order: 20, customIcon: null },
                { id: 69, name: '同花顺', url: 'https://www.10jqka.com.cn', categoryId: 3, order: 21, customIcon: null },
                { id: 70, name: '大智慧', url: 'https://www.gw.com.cn', categoryId: 3, order: 22, customIcon: null },
                { id: 71, name: '金融界', url: 'https://www.jrj.com.cn', categoryId: 3, order: 23, customIcon: null },
                { id: 72, name: '和讯网', url: 'https://www.hexun.com', categoryId: 3, order: 24, customIcon: null },
                
                // 社交分类 - 24个网站
                { id: 73, name: '微信', url: 'https://weixin.qq.com', categoryId: 4, order: 1, customIcon: null },
                { id: 74, name: 'QQ', url: 'https://im.qq.com', categoryId: 4, order: 2, customIcon: null },
                { id: 75, name: '微博', url: 'https://weibo.com', categoryId: 4, order: 3, customIcon: null },
                { id: 76, name: '知乎', url: 'https://www.zhihu.com', categoryId: 4, order: 4, customIcon: null },
                { id: 77, name: '豆瓣', url: 'https://www.douban.com', categoryId: 4, order: 5, customIcon: null },
                { id: 78, name: '小红书', url: 'https://www.xiaohongshu.com', categoryId: 4, order: 6, customIcon: null },
                { id: 79, name: '贴吧', url: 'https://tieba.baidu.com', categoryId: 4, order: 7, customIcon: null },
                { id: 80, name: '人人网', url: 'https://www.renren.com', categoryId: 4, order: 8, customIcon: null },
                { id: 81, name: '陌陌', url: 'https://www.immomo.com', categoryId: 4, order: 9, customIcon: null },
                { id: 82, name: '探探', url: 'https://www.tantanapp.com', categoryId: 4, order: 10, customIcon: null },
                { id: 83, name: 'Soul', url: 'https://www.soulapp.cn', categoryId: 4, order: 11, customIcon: null },
                { id: 84, name: '脉脉', url: 'https://maimai.cn', categoryId: 4, order: 12, customIcon: null },
                { id: 85, name: '领英', url: 'https://www.linkedin.com', categoryId: 4, order: 13, customIcon: null },
                { id: 86, name: 'Facebook', url: 'https://www.facebook.com', categoryId: 4, order: 14, customIcon: null },
                { id: 87, name: 'Twitter', url: 'https://twitter.com', categoryId: 4, order: 15, customIcon: null },
                { id: 88, name: 'Instagram', url: 'https://www.instagram.com', categoryId: 4, order: 16, customIcon: null },
                { id: 89, name: 'Telegram', url: 'https://telegram.org', categoryId: 4, order: 17, customIcon: null },
                { id: 90, name: 'Discord', url: 'https://discord.com', categoryId: 4, order: 18, customIcon: null },
                { id: 91, name: 'Slack', url: 'https://slack.com', categoryId: 4, order: 19, customIcon: null },
                { id: 92, name: 'Teams', url: 'https://www.microsoft.com/teams', categoryId: 4, order: 20, customIcon: null },
                { id: 93, name: 'Zoom', url: 'https://zoom.us', categoryId: 4, order: 21, customIcon: null },
                { id: 94, name: 'Skype', url: 'https://www.skype.com', categoryId: 4, order: 22, customIcon: null },
                { id: 95, name: '钉钉', url: 'https://www.dingtalk.com', categoryId: 4, order: 23, customIcon: null },
                { id: 96, name: '企业微信', url: 'https://work.weixin.qq.com', categoryId: 4, order: 24, customIcon: null },
                
                // 生活分类 - 24个网站
                { id: 97, name: '美团外卖', url: 'https://waimai.meituan.com', categoryId: 5, order: 1, customIcon: null },
                { id: 98, name: '饿了么外卖', url: 'https://h5.ele.me', categoryId: 5, order: 2, customIcon: null },
                { id: 99, name: '大众点评', url: 'https://www.dianping.com', categoryId: 5, order: 3, customIcon: null },
                { id: 100, name: '58同城', url: 'https://www.58.com', categoryId: 5, order: 4, customIcon: null },
                { id: 101, name: '赶集网', url: 'https://www.ganji.com', categoryId: 5, order: 5, customIcon: null },
                { id: 102, name: '链家', url: 'https://www.lianjia.com', categoryId: 5, order: 6, customIcon: null },
                { id: 103, name: '贝壳找房', url: 'https://www.ke.com', categoryId: 5, order: 7, customIcon: null },
                { id: 104, name: '安居客', url: 'https://www.anjuke.com', categoryId: 5, order: 8, customIcon: null },
                { id: 105, name: '房天下', url: 'https://www.fang.com', categoryId: 5, order: 9, customIcon: null },
                { id: 106, name: '滴滴出行', url: 'https://www.didiglobal.com', categoryId: 5, order: 10, customIcon: null },
                { id: 107, name: '高德地图', url: 'https://www.amap.com', categoryId: 5, order: 11, customIcon: null },
                { id: 108, name: '百度地图', url: 'https://map.baidu.com', categoryId: 5, order: 12, customIcon: null },
                { id: 109, name: '腾讯地图', url: 'https://map.qq.com', categoryId: 5, order: 13, customIcon: null },
                { id: 110, name: '天气', url: 'https://weather.com.cn', categoryId: 5, order: 14, customIcon: null },
                { id: 111, name: '墨迹天气', url: 'https://www.moji.com', categoryId: 5, order: 15, customIcon: null },
                { id: 112, name: '万年历', url: 'https://www.wnl.com', categoryId: 5, order: 16, customIcon: null },
                { id: 113, name: '支付宝', url: 'https://www.alipay.com', categoryId: 5, order: 17, customIcon: null },
                { id: 114, name: '微信支付', url: 'https://pay.weixin.qq.com', categoryId: 5, order: 18, customIcon: null },
                { id: 115, name: '云闪付', url: 'https://www.unionpay.com', categoryId: 5, order: 19, customIcon: null },
                { id: 116, name: '京东金融', url: 'https://jr.jd.com', categoryId: 5, order: 20, customIcon: null },
                { id: 117, name: '蚂蚁财富', url: 'https://www.antfortune.com', categoryId: 5, order: 21, customIcon: null },
                { id: 118, name: '同花顺', url: 'https://www.10jqka.com.cn', categoryId: 5, order: 22, customIcon: null },
                { id: 119, name: '大智慧', url: 'https://www.gw.com.cn', categoryId: 5, order: 23, customIcon: null },
                { id: 120, name: '东方财富', url: 'https://www.eastmoney.com', categoryId: 5, order: 24, customIcon: null },
                
                // 工具分类 - 24个网站
                { id: 121, name: '百度网盘', url: 'https://pan.baidu.com', categoryId: 6, order: 1, customIcon: null },
                { id: 122, name: '腾讯微云', url: 'https://www.weiyun.com', categoryId: 6, order: 2, customIcon: null },
                { id: 123, name: '阿里云盘', url: 'https://www.aliyundrive.com', categoryId: 6, order: 3, customIcon: null },
                { id: 124, name: '坚果云', url: 'https://www.jianguoyun.com', categoryId: 6, order: 4, customIcon: null },
                { id: 125, name: 'WPS', url: 'https://www.wps.cn', categoryId: 6, order: 5, customIcon: null },
                { id: 126, name: 'Office', url: 'https://www.office.com', categoryId: 6, order: 6, customIcon: null },
                { id: 127, name: '石墨文档', url: 'https://shimo.im', categoryId: 6, order: 7, customIcon: null },
                { id: 128, name: '腾讯文档', url: 'https://docs.qq.com', categoryId: 6, order: 8, customIcon: null },
                { id: 129, name: '印象笔记', url: 'https://www.yinxiang.com', categoryId: 6, order: 9, customIcon: null },
                { id: 130, name: '有道云笔记', url: 'https://note.youdao.com', categoryId: 6, order: 10, customIcon: null },
                { id: 131, name: 'Notion', url: 'https://www.notion.so', categoryId: 6, order: 11, customIcon: null },
                { id: 132, name: '语雀', url: 'https://www.yuque.com', categoryId: 6, order: 12, customIcon: null },
                { id: 133, name: 'ProcessOn', url: 'https://www.processon.com', categoryId: 6, order: 13, customIcon: null },
                { id: 134, name: '幕布', url: 'https://mubu.com', categoryId: 6, order: 14, customIcon: null },
                { id: 135, name: 'Xmind', url: 'https://www.xmind.cn', categoryId: 6, order: 15, customIcon: null },
                { id: 136, name: 'MindMaster', url: 'https://www.edrawsoft.cn/mindmaster', categoryId: 6, order: 16, customIcon: null },
                { id: 137, name: 'Canva', url: 'https://www.canva.cn', categoryId: 6, order: 17, customIcon: null },
                { id: 138, name: '稿定设计', url: 'https://www.gaoding.com', categoryId: 6, order: 18, customIcon: null },
                { id: 139, name: 'Figma', url: 'https://www.figma.com', categoryId: 6, order: 19, customIcon: null },
                { id: 140, name: '蓝湖', url: 'https://lanhuapp.com', categoryId: 6, order: 20, customIcon: null },
                { id: 141, name: '墨刀', url: 'https://modao.cc', categoryId: 6, order: 21, customIcon: null },
                { id: 142, name: 'Axure', url: 'https://www.axure.com', categoryId: 6, order: 22, customIcon: null },
                { id: 143, name: 'Sketch', url: 'https://www.sketch.com', categoryId: 6, order: 23, customIcon: null },
                { id: 144, name: 'Photoshop', url: 'https://www.adobe.com/products/photoshop.html', categoryId: 6, order: 24, customIcon: null },
                
                // 趣站分类 - 24个网站
                { id: 145, name: 'B站', url: 'https://www.bilibili.com', categoryId: 7, order: 1, customIcon: null },
                { id: 146, name: 'AcFun', url: 'https://www.acfun.cn', categoryId: 7, order: 2, customIcon: null },
                { id: 147, name: '抖音', url: 'https://www.douyin.com', categoryId: 7, order: 3, customIcon: null },
                { id: 148, name: '快手', url: 'https://www.kuaishou.com', categoryId: 7, order: 4, customIcon: null },
                { id: 149, name: '虎牙', url: 'https://www.huya.com', categoryId: 7, order: 5, customIcon: null },
                { id: 150, name: '斗鱼', url: 'https://www.douyu.com', categoryId: 7, order: 6, customIcon: null },
                { id: 151, name: '喜马拉雅', url: 'https://www.ximalaya.com', categoryId: 7, order: 7, customIcon: null },
                { id: 152, name: '蜻蜓FM', url: 'https://www.qingting.fm', categoryId: 7, order: 8, customIcon: null },
                { id: 153, name: '网易云音乐', url: 'https://music.163.com', categoryId: 7, order: 9, customIcon: null },
                { id: 154, name: 'QQ音乐', url: 'https://y.qq.com', categoryId: 7, order: 10, customIcon: null },
                { id: 155, name: '酷狗音乐', url: 'https://www.kugou.com', categoryId: 7, order: 11, customIcon: null },
                { id: 156, name: '酷我音乐', url: 'https://www.kuwo.cn', categoryId: 7, order: 12, customIcon: null },
                { id: 157, name: '咪咕音乐', url: 'https://music.migu.cn', categoryId: 7, order: 13, customIcon: null },
                { id: 158, name: '全民K歌', url: 'https://kg.qq.com', categoryId: 7, order: 14, customIcon: null },
                { id: 159, name: '唱吧', url: 'https://changba.com', categoryId: 7, order: 15, customIcon: null },
                { id: 160, name: '汽水音乐', url: 'https://music.qishui.com', categoryId: 7, order: 16, customIcon: null },
                { id: 161, name: 'Spotify', url: 'https://www.spotify.com', categoryId: 7, order: 17, customIcon: null },
                { id: 162, name: 'Apple Music', url: 'https://music.apple.com', categoryId: 7, order: 18, customIcon: null },
                { id: 163, name: 'YouTube Music', url: 'https://music.youtube.com', categoryId: 7, order: 19, customIcon: null },
                { id: 164, name: 'TikTok', url: 'https://www.tiktok.com', categoryId: 7, order: 20, customIcon: null },
                { id: 165, name: 'Instagram', url: 'https://www.instagram.com', categoryId: 7, order: 21, customIcon: null },
                { id: 166, name: 'Pinterest', url: 'https://www.pinterest.com', categoryId: 7, order: 22, customIcon: null },
                { id: 167, name: 'Reddit', url: 'https://www.reddit.com', categoryId: 7, order: 23, customIcon: null },
                { id: 168, name: 'Twitch', url: 'https://www.twitch.tv', categoryId: 7, order: 24, customIcon: null },
                
                // 尔联分类 - 用户提供的网站
                { id: 169, name: '携程供应商', url: 'https://vbooking.ctrip.com/ivbk/accountV2/login', categoryId: 8, order: 1, customIcon: null },
                { id: 170, name: 'Odoo', url: 'https://crm.ulinktravel.com.tr/web/login', categoryId: 8, order: 2, customIcon: null },
                { id: 171, name: '飞猪用车', url: 'https://sell.fliggy.com/transcrs/index#/orders', categoryId: 8, order: 3, customIcon: null },
                { id: 172, name: '飞猪店铺', url: 'https://work.taobao.com/', categoryId: 8, order: 4, customIcon: null },
                { id: 173, name: 'Whatsapp', url: 'https://www.whatsapp.com/', categoryId: 8, order: 5, customIcon: null },
                { id: 174, name: 'Get Transfer', url: 'https://gettransfer.com/zh/carrier/#/cabinet/requests', categoryId: 8, order: 6, customIcon: null },
                { id: 175, name: 'Viator', url: 'https://supplier.viator.com/?logout=true', categoryId: 8, order: 7, customIcon: null },
                { id: 176, name: '企业微信邮箱', url: 'https://work.weixin.qq.com/mail/', categoryId: 8, order: 8, customIcon: null },
                { id: 177, name: '谷歌翻译', url: 'https://translate.google.com/', categoryId: 8, order: 9, customIcon: null },
                { id: 178, name: '谷歌地图', url: 'https://www.google.com/maps', categoryId: 8, order: 10, customIcon: null },
                { id: 179, name: 'Dida用车', url: 'https://tna-supplier-int.didatravel.com/order', categoryId: 8, order: 11, customIcon: null },
                { id: 180, name: 'Omacar', url: 'http://fleets.omacar.com/', categoryId: 8, order: 12, customIcon: null },
                { id: 181, name: '圣索菲亚大教堂', url: 'https://agency.demmuseums.com/Authentication/SignIn', categoryId: 8, order: 13, customIcon: null },
                { id: 182, name: '地下水宫', url: 'https://www.passo.com.tr/tr/mekan/yerebatan-sarnici-muzeleri-bilet/719215', categoryId: 8, order: 14, customIcon: null },
                { id: 183, name: '旋转舞', url: 'https://www.hodjapasha.com/sistem/login.php', categoryId: 8, order: 15, customIcon: null },
                { id: 184, name: '综合出票', url: 'https://muze.gov.tr/ETicket', categoryId: 8, order: 16, customIcon: null },
                { id: 185, name: '新皇宫-多尔玛巴赫切', url: 'https://acente.millisaraylar.gov.tr/Home/Index', categoryId: 8, order: 17, customIcon: null },
                { id: 186, name: '海峡游船', url: 'https://www.turyol.com/', categoryId: 8, order: 18, customIcon: null },
                { id: 187, name: 'TK-土耳其航空', url: 'https://www.turkishairlines.com/', categoryId: 8, order: 19, customIcon: null },
                { id: 188, name: 'PC-飞马航空', url: 'http://www.flypgs.com', categoryId: 8, order: 20, customIcon: null },
                { id: 189, name: 'XQ-太阳快运', url: 'http://www.sunexpress.com', categoryId: 8, order: 21, customIcon: null },
                { id: 190, name: 'VF-AJET', url: 'https://ajet.com/tr', categoryId: 8, order: 22, customIcon: null },
                { id: 191, name: '机票B2B', url: 'https://acente.biletbank.com/', categoryId: 8, order: 23, customIcon: null },
                { id: 192, name: '土耳其签证', url: 'https://dtvgroup.com.tr/', categoryId: 8, order: 24, customIcon: null }
            ],
            settings: {
                backgroundType: 'gradient',
                backgroundValue: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                primaryColor: '#667eea',
                secondaryColor: '#764ba2',
                pageTitle: '',
                pageSubtitle: '每一次与过往照面，都是为了与未来更好地遇见。',
                pageTitleIcon: '',
                pageTitleFontSize: '48px',
                pageSubtitleFontSize: '24px',
                pageTitleFont: 'Pacifico, cursive',
                pageSubtitleFont: "'Long Cang', cursive",
                searchEngine: 'google',
                textColor: '#ffffff',
                categoryColor: '#ffffff',
                bookmarkColor: '#ffffff',
                rowsPerCategory: 4,
                imageSearchEngine: 'baidu'
            }
        };

        // 状态管理
        let state = {
            categories: [],
            bookmarks: [],
            settings: {},
            currentCategory: null,
            editingBookmarkId: null,
            editingCategoryId: null,
            selectedSkin: null,
            editMode: false,
            showSettingsMenu: false,
            searchEngines: {
                google: { name: '谷歌', icon: 'fab fa-google', color: '#4285f4', url: 'https://www.google.com/search?q=' },
                baidu: { name: '百度', icon: 'baidu-icon', color: '#2932e1', url: 'https://www.baidu.com/s?wd=' },
                bing: { name: '必应', icon: 'fab fa-microsoft', color: '#008373', url: 'https://cn.bing.com/search?q=' },
                so: { name: '360', icon: 'fas fa-shield-alt', color: '#19b955', url: 'https://www.so.com/s?q=' },
                zhihu: { name: '知乎', icon: 'fab fa-zhihu', color: '#0084ff', url: 'https://www.zhihu.com/search?type=content&q=' },
                weibo: { name: '微博', icon: 'fab fa-weibo', color: '#e6162d', url: 'https://s.weibo.com/weibo?q=' },
                douban: { name: '豆瓣', icon: 'fas fa-seedling', color: '#007722', url: 'https://www.douban.com/search?q=' },
                xiaohongshu: { name: '小红书', icon: 'fas fa-heart', color: '#ff2442', url: 'https://www.xiaohongshu.com/search_result?keyword=' },
                bilibili: { name: 'B站', icon: 'fab fa-bilibili', color: '#fb7299', url: 'https://search.bilibili.com/all?keyword=' },
                youtube: { name: 'YouTube', icon: 'fab fa-youtube', color: '#ff0000', url: 'https://www.youtube.com/results?search_query=' },
                netease: { name: '网易云', icon: 'fas fa-music', color: '#e60026', url: 'https://music.163.com/#/search/m/?s=' },
                github: { name: 'GitHub', icon: 'fab fa-github', color: '#333333', url: 'https://github.com/search?q=' },
                metaso: { name: '秘塔AI', icon: 'fas fa-brain', color: '#5b21b6', url: 'https://metaso.cn/?q=' },
                sogou: { name: '搜狗', icon: 'fas fa-search', color: '#ff5500', url: 'https://www.sogou.com/web?query=' },
                duckduckgo: { name: 'DuckGo', icon: 'fas fa-search', color: '#de5833', url: 'https://duckduckgo.com/?q=' },
                yandex: { name: 'Yandex', icon: 'fab fa-yandex', color: '#ff0000', url: 'https://yandex.com/search/?text=' }
            },
            faviconCache: {},
            currentAction: null,
            settingsBtnMode: 'settings',
            defaultIcons: [
                { class: 'fas fa-search icon-search', category: '搜索' },
                { class: 'fab fa-google icon-search', category: '搜索' },
                { class: 'fas fa-globe icon-search', category: '搜索' },
                { class: 'fab fa-youtube icon-video', category: '视频' },
                { class: 'fab fa-bilibili icon-video', category: '视频' },
                { class: 'fab fa-facebook icon-social', category: '社交' },
                { class: 'fab fa-twitter icon-social', category: '社交' },
                { class: 'fab fa-weixin icon-social', category: '社交' },
                { class: 'fas fa-shopping-cart icon-shopping', category: '购物' },
                { class: 'fab fa-amazon icon-shopping', category: '购物' },
                { class: 'fab fa-alipay icon-finance', category: '金融' },
                { class: 'fas fa-plane icon-travel', category: '旅行' },
                { class: 'fas fa-hotel icon-travel', category: '旅行' },
                { class: 'fas fa-briefcase icon-work', category: '工作' },
                { class: 'fas fa-graduation-cap icon-education', category: '教育' },
                { class: 'fas fa-gamepad icon-games', category: '游戏' },
                { class: 'fas fa-music icon-music', category: '音乐' },
                { class: 'fas fa-film icon-video', category: '视频' },
                { class: 'fas fa-newspaper icon-news', category: '新闻' },
                { class: 'fas fa-wrench icon-tools', category: '工具' },
                { class: 'fas fa-utensils icon-food', category: '美食' },
                { class: 'fas fa-heartbeat icon-health', category: '健康' },
                { class: 'fas fa-code icon-tech', category: '技术' },
                { class: 'fas fa-futbol icon-sports', category: '体育' },
                { class: 'fas fa-cloud-sun icon-weather', category: '天气' },
                { class: 'fas fa-book icon-books', category: '书籍' },
                { class: 'fas fa-palette icon-art', category: '艺术' },
                { class: 'fas fa-camera icon-art', category: '艺术' }
            ],
            draggingCategoryId: null,
            draggingBookmarkId: null,
            titleIconPreview: null,
            fontLibrary: [
                { name: '圆润体', value: 'Pacifico, cursive', family: 'Pacifico' },
                { name: '手写体', value: "'Dancing Script', cursive", family: 'Dancing Script' },
                { name: '衬线体', value: "'Playfair Display', serif", family: 'Playfair Display' },
                { name: '现代体', value: "'Montserrat', sans-serif", family: 'Montserrat' },
                { name: '简洁体', value: "'Roboto', sans-serif", family: 'Roboto' },
                { name: '手写2体', value: "'Caveat', cursive", family: 'Caveat' },
                { name: '阴影体', value: "'Shadows Into Light', cursive", family: 'Shadows Into Light' },
                { name: '典雅体', value: "'Fredericka the Great', cursive", family: 'Fredericka the Great' },
                { name: '打字机体', value: "'Special Elite', cursive", family: 'Special Elite' },
                { name: '龙藏体', value: "'Long Cang', cursive", family: 'Long Cang' },
                { name: '思源黑体', value: "'Noto Sans SC', sans-serif", family: 'Noto Sans SC' },
                { name: '站酷小微', value: "'ZCOOL XiaoWei', serif", family: 'ZCOOL XiaoWei' },
                { name: '站酷青楷', value: "'ZCOOL QingKe HuangYou', sans-serif", family: 'ZCOOL QingKe HuangYou' },
                { name: '马善政体', value: "'Ma Shan Zheng', cursive", family: 'Ma Shan Zheng' },
                { name: '刘剑毛笔', value: "'Liu Jian Mao Cao', cursive", family: 'Liu Jian Mao Cao' },
                { name: '楷体', value: "'KaiTi', cursive", family: 'KaiTi' },
                { name: '宋体', value: "'SimSun', serif", family: 'SimSun' },
                { name: '微软雅黑', value: "'Microsoft YaHei', sans-serif", family: 'Microsoft YaHei' },
                { name: 'Arial体', value: 'Arial, sans-serif', family: 'Arial' },
                { name: 'Times体', value: "'Times New Roman', serif", family: 'Times New Roman' }
            ],
            importType: 'replace',
            imageSearch: {
                selectedEngine: 'baidu',
                uploadedImage: null,
                imageUrl: '',
                imageFile: null
            },
            fontEditMode: 'title',
            dragTargetIndex: -1
        };

        // DOM元素
        const elements = {
            mainContainer: document.getElementById('mainContainer'),
            categoriesContainer: document.getElementById('categoriesContainer'),
            bookmarksContainer: document.getElementById('bookmarksContainer'),
            editBookmarkModal: document.getElementById('editBookmarkModal'),
            editCategoryModal: document.getElementById('editCategoryModal'),
            addCategoryModal: document.getElementById('addCategoryModal'),
            colorBgModal: document.getElementById('colorBgModal'),
            importExportModal: document.getElementById('importExportModal'),
            imageSearchModal: document.getElementById('imageSearchModal'),
            backgroundImage: document.getElementById('backgroundImage'),
            pageTitle: document.getElementById('pageTitle'),
            pageSubtitle: document.getElementById('pageSubtitle'),
            searchInput: document.getElementById('searchInput'),
            currentEngine: document.getElementById('currentEngine'),
            engineGrid: document.getElementById('engineGrid'),
            searchBtn: document.getElementById('searchBtn'),
            imageSearchBtn: document.getElementById('imageSearchBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsMenu: document.getElementById('settingsMenu'),
            customizeBtn: document.getElementById('customizeBtn'),
            colorBgBtn: document.getElementById('colorBgBtn'),
            importExportBtn: document.getElementById('importExportBtn'),
            resetBtn: document.getElementById('resetBtn'),
            closeImportExportModalBtn: document.getElementById('closeImportExportModalBtn'),
            exportDataBtn: document.getElementById('exportDataBtn'),
            importFileInput: document.getElementById('importFileInput'),
            importDataBtn: document.getElementById('importDataBtn'),
            cancelImportExportBtn: document.getElementById('cancelImportExportBtn'),
            importError: document.getElementById('importError'),
            dragHint: document.getElementById('dragHint'),
            iconSelector: document.getElementById('iconSelector'),
            titleIconPreview: document.getElementById('titleIconPreview'),
            titleIconUpload: document.getElementById('titleIconUpload'),
            removeTitleIconBtn: document.getElementById('removeTitleIconBtn'),
            editTitleText: document.getElementById('editTitleText'),
            editSubtitleText: document.getElementById('editSubtitleText'),
            titleFontSize: document.getElementById('titleFontSize'),
            titleFontSizeValue: document.getElementById('titleFontSizeValue'),
            subtitleFontSize: document.getElementById('subtitleFontSize'),
            subtitleFontSizeValue: document.getElementById('subtitleFontSizeValue'),
            skinGrid: document.getElementById('skinGrid'),
            confirmDialog: document.getElementById('confirmDialog'),
            confirmDialogTitle: document.getElementById('confirmDialogTitle'),
            confirmDialogMessage: document.getElementById('confirmDialogMessage'),
            confirmDialogCancelBtn: document.getElementById('confirmDialogCancelBtn'),
            confirmDialogConfirmBtn: document.getElementById('confirmDialogConfirmBtn'),
            fontSelector: document.getElementById('fontSelector'),
            titleFontTypeBtn: document.getElementById('titleFontTypeBtn'),
            subtitleFontTypeBtn: document.getElementById('subtitleFontTypeBtn'),
            importOptions: document.getElementById('importOptions'),
            importOptionReplace: document.getElementById('importOptionReplace'),
            importOptionAdd: document.getElementById('importOptionAdd'),
            importTypeReplace: document.getElementById('importTypeReplace'),
            importTypeAdd: document.getElementById('importTypeAdd'),
            imageUploadArea: document.getElementById('imageUploadArea'),
            imageUploadInput: document.getElementById('imageUploadInput'),
            imagePreview: document.getElementById('imagePreview'),
            imageUrlInput: document.getElementById('imageUrlInput'),
            imageSearchEngines: document.getElementById('imageSearchEngines'),
            startImageSearchBtn: document.getElementById('startImageSearchBtn'),
            cancelImageSearchBtn: document.getElementById('cancelImageSearchBtn'),
            closeImageSearchModalBtn: document.getElementById('closeImageSearchModalBtn'),
            imageSearchError: document.getElementById('imageSearchError')
        };

        // 初始化应用
        function initApp() {
            loadData();
            renderSearchEngines();
            renderCategories();
            applySettings();
            setupEventListeners();
            
            // 确保第一个分类默认显示
            if (state.categories.length > 0) {
                state.currentCategory = state.categories[0].id;
                setActiveCategory(state.currentCategory, true);
                renderBookmarks();
            }
            
            updateSearchEngineDisplay();
            preloadFavicons();
            renderIconSelector();
            renderSkinGrid();
            setRandomSearchPlaceholder();
            setupColorPickers();
            setupFontSelectors();
            renderImageSearchEngines();
            setupImportOptions();
            setupImageDragDrop();
            
            // 点击空白处关闭设置菜单
            document.addEventListener('click', (e) => {
                if (!elements.settingsBtn.contains(e.target) && !elements.settingsMenu.contains(e.target)) {
                    elements.settingsMenu.classList.remove('show');
                }
            });
        }

        // 加载数据
        function loadData() {
            const savedData = localStorage.getItem('navPageData');
            
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    state.categories = parsedData.categories || initialData.categories;
                    state.bookmarks = parsedData.bookmarks || initialData.bookmarks;
                    state.settings = parsedData.settings || initialData.settings;
                    
                    // 清洗脏数据
                    state.bookmarks.forEach(bookmark => {
                        bookmark.customIcon = null;
                    });
                    
                    ensureSettings();
                    ensureOrderFields();
                } catch (e) {
                    console.error('解析保存的数据失败，使用初始数据', e);
                    state.categories = [...initialData.categories];
                    state.bookmarks = [...initialData.bookmarks];
                    state.settings = {...initialData.settings};
                    ensureSettings();
                }
            } else {
                state.categories = [...initialData.categories];
                state.bookmarks = [...initialData.bookmarks];
                state.settings = {...initialData.settings};
                ensureSettings();
                saveData();
            }
        }

        // 确保设置存在
        function ensureSettings() {
            const defaults = initialData.settings;
            if (!state.settings.rowsPerCategory) state.settings.rowsPerCategory = defaults.rowsPerCategory;
            if (!state.settings.textColor) state.settings.textColor = defaults.textColor;
            if (!state.settings.categoryColor) state.settings.categoryColor = defaults.categoryColor;
            if (!state.settings.bookmarkColor) state.settings.bookmarkColor = defaults.bookmarkColor;
            if (!state.settings.pageTitleIcon) state.settings.pageTitleIcon = defaults.pageTitleIcon;
            if (!state.settings.pageTitleFontSize) state.settings.pageTitleFontSize = defaults.pageTitleFontSize;
            if (!state.settings.pageSubtitleFontSize) state.settings.pageSubtitleFontSize = defaults.pageSubtitleFontSize;
            if (!state.settings.pageTitleFont) state.settings.pageTitleFont = defaults.pageTitleFont;
            if (!state.settings.pageSubtitle) state.settings.pageSubtitle = defaults.pageSubtitle;
            if (!state.settings.pageSubtitleFont) state.settings.pageSubtitleFont = defaults.pageSubtitleFont;
            if (!state.settings.imageSearchEngine) state.settings.imageSearchEngine = defaults.imageSearchEngine;
        }

        // 确保order字段存在
        function ensureOrderFields() {
            state.categories.sort((a, b) => (a.order || 0) - (b.order || 0));
            state.categories.forEach((category, index) => {
                if (!category.order) {
                    category.order = index + 1;
                }
            });
            
            const bookmarksByCategory = {};
            state.bookmarks.forEach(bookmark => {
                if (!bookmarksByCategory[bookmark.categoryId]) {
                    bookmarksByCategory[bookmark.categoryId] = [];
                }
                bookmarksByCategory[bookmark.categoryId].push(bookmark);
            });
            
            Object.keys(bookmarksByCategory).forEach(categoryId => {
                bookmarksByCategory[categoryId].sort((a, b) => (a.order || 0) - (b.order || 0));
                bookmarksByCategory[categoryId].forEach((bookmark, index) => {
                    bookmark.order = index + 1;
                });
            });
        }

        // 保存数据
        function saveData() {
            const dataToSave = {
                categories: state.categories,
                bookmarks: state.bookmarks,
                settings: state.settings
            };
            localStorage.setItem('navPageData', JSON.stringify(dataToSave));
        }

        // 渲染搜索引擎
        function renderSearchEngines() {
            elements.engineGrid.innerHTML = '';
            
            Object.entries(state.searchEngines).forEach(([key, engine]) => {
                const item = document.createElement('div');
                item.className = 'engine-grid-item';
                item.dataset.engine = key;
                item.style.color = engine.color;
                
                // 特殊处理百度图标
                let iconHTML = '';
                if (engine.icon === 'baidu-icon') {
                    iconHTML = `<div class="baidu-icon"></div>`;
                } else {
                    iconHTML = `<i class="${engine.icon}" style="color: ${engine.color}; font-size: 28px;"></i>`;
                }
                
                item.innerHTML = `
                    <div class="engine-grid-icon">
                        ${iconHTML}
                    </div>
                    <div class="engine-grid-name">${engine.name}</div>
                `;
                
                item.addEventListener('click', () => {
                    if (state.editMode) return;
                    state.settings.searchEngine = key;
                    saveData();
                    updateSearchEngineDisplay();
                    elements.engineGrid.classList.remove('show');
                });
                
                elements.engineGrid.appendChild(item);
            });
        }

        // 渲染图标选择器
        function renderIconSelector() {
            elements.iconSelector.innerHTML = '';
            
            const iconsByCategory = {};
            state.defaultIcons.forEach(icon => {
                if (!iconsByCategory[icon.category]) {
                    iconsByCategory[icon.category] = [];
                }
                iconsByCategory[icon.category].push(icon);
            });
            
            Object.keys(iconsByCategory).forEach(category => {
                const categoryTitle = document.createElement('div');
                categoryTitle.style.gridColumn = '1 / -1';
                categoryTitle.style.fontSize = '12px';
                categoryTitle.style.color = '#666';
                categoryTitle.style.marginTop = '10px';
                categoryTitle.style.marginBottom = '5px';
                categoryTitle.textContent = category;
                elements.iconSelector.appendChild(categoryTitle);
                
                iconsByCategory[category].forEach(icon => {
                    const iconOption = document.createElement('div');
                    iconOption.className = 'icon-option';
                    iconOption.innerHTML = `<i class="${icon.class}"></i>`;
                    iconOption.dataset.icon = icon.class;
                    iconOption.title = category;
                    
                    iconOption.addEventListener('click', () => {
                        document.querySelectorAll('.icon-option').forEach(option => {
                            option.classList.remove('selected');
                        });
                        iconOption.classList.add('selected');
                    });
                    
                    elements.iconSelector.appendChild(iconOption);
                });
            });
        }

        // 渲染皮肤网格
        function renderSkinGrid() {
            elements.skinGrid.innerHTML = '';
            
            skinPresets.forEach(skin => {
                const skinItem = document.createElement('div');
                skinItem.className = 'skin-item';
                skinItem.dataset.skin = skin.id;
                
                skinItem.innerHTML = `
                    <div class="skin-preview" style="background: ${skin.bgValue}; color: ${skin.textColor === '#ffffff' ? 'white' : '#333'};">
                        ${skin.name}
                    </div>
                    <div class="skin-name">${skin.name}</div>
                `;
                
                skinItem.addEventListener('click', () => {
                    document.querySelectorAll('.skin-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    skinItem.classList.add('selected');
                    state.selectedSkin = skin;
                });
                
                elements.skinGrid.appendChild(skinItem);
            });
        }

        // 设置颜色选择器
        function setupColorPickers() {
            // 标题颜色
            const titleColorPicker = document.getElementById('titleColorPicker');
            const titleColorValue = document.getElementById('titleColorValue');
            titleColorPicker.value = state.settings.textColor;
            titleColorValue.textContent = state.settings.textColor.toUpperCase();
            
            titleColorPicker.addEventListener('input', (e) => {
                titleColorValue.textContent = e.target.value.toUpperCase();
            });
            
            // 分类颜色
            const categoryColorPicker = document.getElementById('categoryColorPicker');
            const categoryColorValue = document.getElementById('categoryColorValue');
            categoryColorPicker.value = state.settings.categoryColor;
            categoryColorValue.textContent = state.settings.categoryColor.toUpperCase();
            
            categoryColorPicker.addEventListener('input', (e) => {
                categoryColorValue.textContent = e.target.value.toUpperCase();
            });
            
            // 网站颜色
            const bookmarkColorPicker = document.getElementById('bookmarkColorPicker');
            const bookmarkColorValue = document.getElementById('bookmarkColorValue');
            bookmarkColorPicker.value = state.settings.bookmarkColor;
            bookmarkColorValue.textContent = state.settings.bookmarkColor.toUpperCase();
            
            bookmarkColorPicker.addEventListener('input', (e) => {
                bookmarkColorValue.textContent = e.target.value.toUpperCase();
            });
            
            // 主色调
            const primaryColorPicker = document.getElementById('primaryColorPicker');
            const primaryColorValue = document.getElementById('primaryColorValue');
            primaryColorPicker.value = state.settings.primaryColor;
            primaryColorValue.textContent = state.settings.primaryColor.toUpperCase();
            
            primaryColorPicker.addEventListener('input', (e) => {
                primaryColorValue.textContent = e.target.value.toUpperCase();
            });
            
            // 副色调
            const secondaryColorPicker = document.getElementById('secondaryColorPicker');
            const secondaryColorValue = document.getElementById('secondaryColorValue');
            secondaryColorPicker.value = state.settings.secondaryColor;
            secondaryColorValue.textContent = state.settings.secondaryColor.toUpperCase();
            
            secondaryColorPicker.addEventListener('input', (e) => {
                secondaryColorValue.textContent = e.target.value.toUpperCase();
            });
        }

        // 设置字体选择器
        function setupFontSelectors() {
            elements.fontSelector.innerHTML = '';
            
            elements.titleFontTypeBtn.addEventListener('click', () => {
                state.fontEditMode = 'title';
                elements.titleFontTypeBtn.classList.add('active');
                elements.subtitleFontTypeBtn.classList.remove('active');
                updateFontOptionsDisplay();
            });
            
            elements.subtitleFontTypeBtn.addEventListener('click', () => {
                state.fontEditMode = 'subtitle';
                elements.subtitleFontTypeBtn.classList.add('active');
                elements.titleFontTypeBtn.classList.remove('active');
                updateFontOptionsDisplay();
            });
            
            state.fontLibrary.forEach(font => {
                const fontOption = document.createElement('div');
                fontOption.className = 'font-option';
                fontOption.dataset.font = font.value;
                fontOption.textContent = font.name;
                fontOption.style.fontFamily = font.value;
                
                fontOption.addEventListener('click', () => {
                    if (state.fontEditMode === 'title') {
                        state.settings.pageTitleFont = font.value;
                    } else {
                        state.settings.pageSubtitleFont = font.value;
                    }
                    updateFontOptionsDisplay();
                });
                
                elements.fontSelector.appendChild(fontOption);
            });
            
            elements.titleFontSize.value = parseInt(state.settings.pageTitleFontSize) || 48;
            elements.titleFontSizeValue.textContent = elements.titleFontSize.value + 'px';
            
            elements.subtitleFontSize.value = parseInt(state.settings.pageSubtitleFontSize) || 24;
            elements.subtitleFontSizeValue.textContent = elements.subtitleFontSize.value + 'px';
            
            elements.titleFontSize.addEventListener('input', (e) => {
                elements.titleFontSizeValue.textContent = e.target.value + 'px';
            });
            
            elements.subtitleFontSize.addEventListener('input', (e) => {
                elements.subtitleFontSizeValue.textContent = e.target.value + 'px';
            });
            
            updateFontOptionsDisplay();
        }

        // 更新字体选项显示
        function updateFontOptionsDisplay() {
            const currentFont = state.fontEditMode === 'title' 
                ? state.settings.pageTitleFont 
                : state.settings.pageSubtitleFont;
            
            elements.fontSelector.querySelectorAll('.font-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.font === currentFont) {
                    option.classList.add('selected');
                }
                
                option.style.fontFamily = option.dataset.font;
            });
        }

        // 渲染图片搜索引擎
        function renderImageSearchEngines() {
            elements.imageSearchEngines.innerHTML = '';
            
            Object.entries(imageSearchEnginesData).forEach(([key, engine]) => {
                const engineItem = document.createElement('div');
                engineItem.className = 'image-search-engine';
                engineItem.dataset.engine = key;
                
                if (key === state.settings.imageSearchEngine) {
                    engineItem.classList.add('selected');
                }
                
                engineItem.innerHTML = `
                    <div class="image-search-engine-icon">
                        <i class="${engine.icon}"></i>
                    </div>
                    <div class="image-search-engine-name">${engine.name}</div>
                `;
                
                engineItem.addEventListener('click', () => {
                    elements.imageSearchEngines.querySelectorAll('.image-search-engine').forEach(item => {
                        item.classList.remove('selected');
                    });
                    engineItem.classList.add('selected');
                    state.imageSearch.selectedEngine = key;
                    updateImageSearchButtonState();
                });
                
                elements.imageSearchEngines.appendChild(engineItem);
            });
            
            updateImageSearchButtonState();
        }

        // 设置图片拖拽上传
        function setupImageDragDrop() {
            // 为搜索框添加拖拽事件
            const searchBox = document.querySelector('.search-box');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                searchBox.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                searchBox.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                searchBox.addEventListener(eventName, unhighlight, false);
            });
            
            searchBox.addEventListener('drop', handleDrop, false);
            
            // 为图片上传区域添加拖拽事件
            const imageUploadArea = elements.imageUploadArea;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, () => {
                    imageUploadArea.classList.add('dragover');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, () => {
                    imageUploadArea.classList.remove('dragover');
                }, false);
            });
            
            imageUploadArea.addEventListener('drop', handleImageUploadDrop, false);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            const searchBox = document.querySelector('.search-box');
            searchBox.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.8)';
            searchBox.style.borderColor = 'rgba(102, 126, 234, 0.8)';
            searchBox.style.transform = 'scale(1.02)';
        }

        function unhighlight(e) {
            const searchBox = document.querySelector('.search-box');
            searchBox.style.boxShadow = '';
            searchBox.style.borderColor = '';
            searchBox.style.transform = '';
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    openImageSearchModal();
                    setTimeout(() => {
                        handleImageFile(file);
                    }, 100);
                }
            }
        }

        function handleImageUploadDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    handleImageFile(file);
                }
            }
        }

        // 处理图片文件
        function handleImageFile(file) {
            state.imageSearch.imageFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                elements.imagePreview.src = e.target.result;
                elements.imagePreview.style.display = 'block';
                state.imageSearch.uploadedImage = e.target.result;
                updateImageSearchButtonState();
            };
            reader.readAsDataURL(file);
        }

        // 更新图片搜索按钮状态
        function updateImageSearchButtonState() {
            const hasImage = state.imageSearch.uploadedImage || state.imageSearch.imageUrl.trim() !== '';
            const hasEngine = state.imageSearch.selectedEngine;
            
            if (hasImage && hasEngine) {
                elements.startImageSearchBtn.disabled = false;
            } else {
                elements.startImageSearchBtn.disabled = true;
            }
        }

        // 设置导入选项
        function setupImportOptions() {
            elements.importOptionReplace.addEventListener('click', () => {
                elements.importTypeReplace.checked = true;
                updateImportOptionSelection();
                state.importType = 'replace';
            });
            
            elements.importOptionAdd.addEventListener('click', () => {
                elements.importTypeAdd.checked = true;
                updateImportOptionSelection();
                state.importType = 'add';
            });
            
            elements.importTypeReplace.addEventListener('change', () => {
                updateImportOptionSelection();
                state.importType = 'replace';
            });
            
            elements.importTypeAdd.addEventListener('change', () => {
                updateImportOptionSelection();
                state.importType = 'add';
            });
            
            updateImportOptionSelection();
        }

        // 更新导入选项选择状态
        function updateImportOptionSelection() {
            if (elements.importTypeReplace.checked) {
                elements.importOptionReplace.classList.add('selected');
                elements.importOptionAdd.classList.remove('selected');
            } else {
                elements.importOptionAdd.classList.add('selected');
                elements.importOptionReplace.classList.remove('selected');
            }
        }

        // 设置随机搜索框提示语
        function setRandomSearchPlaceholder() {
            if (searchPlaceholders && searchPlaceholders.length > 0) {
                const randomIndex = Math.floor(Math.random() * searchPlaceholders.length);
                elements.searchInput.placeholder = searchPlaceholders[randomIndex];
            }
        }

        // 预加载favicon
        function preloadFavicons() {
            state.bookmarks.forEach(bookmark => {
                if (!state.faviconCache[bookmark.url]) {
                    getFavicon(bookmark.url);
                }
            });
        }

        // 获取网站favicon
        function getFavicon(url) {
            if (state.faviconCache[url]) {
                return state.faviconCache[url];
            }
            
            try {
                const domain = new URL(url).hostname;
                const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
                state.faviconCache[url] = faviconUrl;
                return faviconUrl;
            } catch (error) {
                state.faviconCache[url] = null;
                return null;
            }
        }

        // 渲染分类
        function renderCategories() {
            elements.categoriesContainer.innerHTML = '';
            
            const sortedCategories = [...state.categories].sort((a, b) => a.order - b.order);
            
            sortedCategories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.dataset.id = category.id;
                categoryItem.dataset.order = category.order;
                
                if (state.editMode) {
                    categoryItem.classList.add('edit-mode');
                    categoryItem.draggable = true;
                    
                    setupCategoryDragEvents(categoryItem, category.id);
                }
                
                const editButtons = document.createElement('div');
                editButtons.className = 'category-edit-buttons';
                editButtons.innerHTML = `
                    <button class="edit-btn-small delete-category-btn" data-id="${category.id}" title="删除分类">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="edit-btn-small rename-category-btn" data-id="${category.id}" title="重命名分类">
                        <i class="fas fa-edit"></i>
                    </button>
                `;
                
                const button = document.createElement('button');
                button.className = 'category-btn';
                if (category.id === state.currentCategory) {
                    button.classList.add('active');
                }
                button.textContent = category.name;
                button.dataset.id = category.id;
                button.style.whiteSpace = 'nowrap';
                
                button.addEventListener('click', () => {
                    setActiveCategory(category.id);
                });
                
                categoryItem.appendChild(editButtons);
                categoryItem.appendChild(button);
                elements.categoriesContainer.appendChild(categoryItem);
            });
            
            if (state.editMode) {
                const addButton = document.createElement('button');
                addButton.className = 'add-category-btn';
                addButton.innerHTML = '<i class="fas fa-plus"></i> 添加分类';
                addButton.addEventListener('click', openAddCategoryModal);
                elements.categoriesContainer.appendChild(addButton);
            }
            
            document.querySelectorAll('.delete-category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const categoryId = parseInt(btn.dataset.id);
                    deleteCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.rename-category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const categoryId = parseInt(btn.dataset.id);
                    openEditCategoryModal(categoryId);
                });
            });
        }

        // 设置分类拖拽事件
        function setupCategoryDragEvents(categoryItem, categoryId) {
            categoryItem.addEventListener('dragstart', (e) => {
                state.draggingCategoryId = categoryId;
                categoryItem.classList.add('dragging');
                e.dataTransfer.setData('text/plain', categoryId);
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setDragImage(categoryItem, 20, 20);
            });
            
            categoryItem.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                if (state.draggingCategoryId !== categoryId) {
                    categoryItem.classList.add('drag-over');
                }
            });
            
            categoryItem.addEventListener('dragenter', (e) => {
                if (state.draggingCategoryId !== categoryId) {
                    categoryItem.classList.add('drag-over');
                }
            });
            
            categoryItem.addEventListener('dragleave', (e) => {
                categoryItem.classList.remove('drag-over');
            });
            
            categoryItem.addEventListener('drop', (e) => {
                e.preventDefault();
                categoryItem.classList.remove('drag-over');
                
                if (state.draggingCategoryId && state.draggingCategoryId !== categoryId) {
                    const draggingCategory = state.categories.find(c => c.id === state.draggingCategoryId);
                    const targetCategory = state.categories.find(c => c.id === categoryId);
                    
                    if (draggingCategory && targetCategory) {
                        const categories = [...state.categories];
                        const draggingIndex = categories.findIndex(c => c.id === state.draggingCategoryId);
                        const targetIndex = categories.findIndex(c => c.id === categoryId);
                        
                        const [draggedItem] = categories.splice(draggingIndex, 1);
                        categories.splice(targetIndex, 0, draggedItem);
                        
                        categories.forEach((cat, index) => {
                            cat.order = index + 1;
                        });
                        
                        state.categories = categories;
                        
                        saveData();
                        renderCategories();
                        
                        if (state.currentCategory === state.draggingCategoryId) {
                            state.currentCategory = categoryId;
                        }
                    }
                }
            });
            
            categoryItem.addEventListener('dragend', (e) => {
                categoryItem.classList.remove('dragging');
                categoryItem.classList.remove('drag-over');
                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                state.draggingCategoryId = null;
            });
        }

        // 渲染书签
        function renderBookmarks() {
            elements.bookmarksContainer.innerHTML = '';
            
            const sortedCategories = [...state.categories].sort((a, b) => a.order - b.order);
            
            sortedCategories.forEach(category => {
                const section = document.createElement('div');
                section.className = 'bookmarks-section';
                section.id = `category-${category.id}`;
                
                if (category.id === state.currentCategory) {
                    section.classList.add('active');
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
                
                const grid = document.createElement('div');
                grid.className = 'bookmarks-grid';
                
                const categoryBookmarks = state.bookmarks
                    .filter(bookmark => bookmark.categoryId === category.id)
                    .sort((a, b) => a.order - b.order);
                
                categoryBookmarks.forEach(bookmark => {
                    const bookmarkElement = createBookmarkElement(bookmark, category.id);
                    grid.appendChild(bookmarkElement);
                });
                
                const rows = state.settings.rowsPerCategory || 4;
                const totalSlots = rows * 6;
                const emptySlots = totalSlots - categoryBookmarks.length;

                for (let i = 0; i < emptySlots; i++) {
                    const emptySlot = document.createElement('div');
                    emptySlot.className = 'bookmark-item empty-slot';
                    emptySlot.innerHTML = `<div class="bookmark-icon" style="background:transparent;"><i class="fas fa-plus" style="opacity:0.3"></i></div><div class="bookmark-name">空位</div>`;
                    
                    if (state.editMode) {
                        emptySlot.style.opacity = '0.5';
                        emptySlot.style.cursor = 'pointer';
                        emptySlot.style.visibility = 'visible';
                        emptySlot.addEventListener('click', () => {
                            openAddBookmarkModal(category.id);
                        });
                    }
                    grid.appendChild(emptySlot);
                }
                
                if (state.editMode) {
                    const addRowBtn = document.createElement('button');
                    addRowBtn.className = 'add-row-btn';
                    addRowBtn.innerHTML = '<i class="fas fa-plus-circle"></i> 增加一行';
                    addRowBtn.addEventListener('click', () => {
                        changeRowsPerCategory('add');
                    });
                    grid.appendChild(addRowBtn);
                    
                    if (rows > 1) {
                        const removeRowBtn = document.createElement('button');
                        removeRowBtn.className = 'remove-row-btn';
                        removeRowBtn.innerHTML = '<i class="fas fa-minus-circle"></i> 减少一行';
                        removeRowBtn.addEventListener('click', () => {
                            changeRowsPerCategory('remove');
                        });
                        grid.appendChild(removeRowBtn);
                    }
                }
                
                section.appendChild(grid);
                elements.bookmarksContainer.appendChild(section);
            });
        }

        // 创建书签元素 - 改进拖拽逻辑
        function createBookmarkElement(bookmark, categoryId) {
            const item = document.createElement('a');
            item.className = 'bookmark-item';
            item.href = bookmark.url;
            item.target = '_blank';
            item.dataset.id = bookmark.id;
            item.dataset.category = categoryId;
            item.dataset.order = bookmark.order;
            
            const faviconUrl = getFavicon(bookmark.url);
            
            let iconHTML = '';
            if (faviconUrl) {
                iconHTML = `<img src="${faviconUrl}" class="bookmark-icon-img" alt="${bookmark.name}图标">`;
            } else if (bookmark.customIcon) {
                iconHTML = `<i class="${bookmark.customIcon}"></i>`;
            } else {
                const iconClass = getIconByWebsiteType(bookmark.name, bookmark.url);
                iconHTML = `<i class="${iconClass}"></i>`;
            }
            
            item.innerHTML = `
                <div class="bookmark-icon">
                    ${iconHTML}
                </div>
                <div class="bookmark-name" title="${bookmark.name}">${bookmark.name}</div>
                <button class="bookmark-edit-btn" data-id="${bookmark.id}">
                    <i class="fas fa-edit"></i>
                </button>
            `;
            
            const editBtn = item.querySelector('.bookmark-edit-btn');
            editBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                openEditBookmarkModal(bookmark.id);
            });
            
            if (state.editMode) {
                item.draggable = true;
                item.addEventListener('click', (e) => { e.preventDefault(); });
                setupBookmarkDragEvents(item, bookmark.id);
            }
            
            return item;
        }

        // 设置书签拖拽事件 - 改进版本，实现位置交换
        function setupBookmarkDragEvents(item, bookmarkId) {
            item.addEventListener('dragstart', (e) => {
                state.draggingBookmarkId = bookmarkId;
                state.dragTargetIndex = -1;
                item.classList.add('dragging');
                e.dataTransfer.setData('text/plain', bookmarkId);
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setDragImage(item, 20, 20);
                
                // 添加占位符
                const placeholder = document.createElement('div');
                placeholder.className = 'bookmark-drag-placeholder';
                placeholder.style.width = item.offsetWidth + 'px';
                placeholder.style.height = item.offsetHeight + 'px';
                placeholder.dataset.placeholder = 'true';
                item.parentNode.insertBefore(placeholder, item);
            });
            
            item.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                if (state.draggingBookmarkId !== bookmarkId) {
                    item.classList.add('drag-over');
                    
                    // 计算目标位置
                    const rect = item.getBoundingClientRect();
                    const verticalMiddle = rect.top + rect.height / 2;
                    const horizontalMiddle = rect.left + rect.width / 2;
                    
                    // 根据拖拽位置决定插入位置
                    if (e.clientY < verticalMiddle) {
                        // 插入到当前元素之前
                        state.dragTargetIndex = Array.from(item.parentNode.children).indexOf(item);
                    } else {
                        // 插入到当前元素之后
                        state.dragTargetIndex = Array.from(item.parentNode.children).indexOf(item) + 1;
                    }
                }
            });
            
            item.addEventListener('dragenter', (e) => {
                if (state.draggingBookmarkId !== bookmarkId) {
                    item.classList.add('drag-over');
                }
            });
            
            item.addEventListener('dragleave', (e) => {
                // 只有当鼠标离开元素且不进入子元素时才移除高亮
                if (!item.contains(e.relatedTarget)) {
                    item.classList.remove('drag-over');
                }
            });
            
            item.addEventListener('drop', (e) => {
                e.preventDefault();
                item.classList.remove('drag-over');
                
                if (state.draggingBookmarkId && state.draggingBookmarkId !== bookmarkId) {
                    const draggingBookmark = state.bookmarks.find(b => b.id === state.draggingBookmarkId);
                    const targetBookmark = state.bookmarks.find(b => b.id === bookmarkId);
                    
                    if (draggingBookmark && targetBookmark && draggingBookmark.categoryId === targetBookmark.categoryId) {
                        const categoryBookmarks = state.bookmarks
                            .filter(b => b.categoryId === draggingBookmark.categoryId)
                            .sort((a, b) => a.order - b.order);
                        
                        const draggingIndex = categoryBookmarks.findIndex(b => b.id === state.draggingBookmarkId);
                        const targetIndex = categoryBookmarks.findIndex(b => b.id === bookmarkId);
                        
                        // 调整位置
                        const [draggedItem] = categoryBookmarks.splice(draggingIndex, 1);
                        
                        // 根据拖拽时的位置决定插入点
                        let insertIndex;
                        if (state.dragTargetIndex !== -1) {
                            // 使用计算出的目标位置
                            insertIndex = state.dragTargetIndex > draggingIndex ? state.dragTargetIndex - 1 : state.dragTargetIndex;
                        } else {
                            // 回退到基于鼠标位置的计算
                            const rect = item.getBoundingClientRect();
                            const verticalMiddle = rect.top + rect.height / 2;
                            insertIndex = e.clientY < verticalMiddle ? targetIndex : targetIndex + 1;
                        }
                        
                        // 确保索引有效
                        insertIndex = Math.max(0, Math.min(insertIndex, categoryBookmarks.length));
                        categoryBookmarks.splice(insertIndex, 0, draggedItem);
                        
                        // 重新排序
                        categoryBookmarks.forEach((bookmark, index) => {
                            bookmark.order = index + 1;
                        });
                        
                        saveData();
                        renderBookmarks();
                    }
                }
            });
            
            item.addEventListener('dragend', (e) => {
                item.classList.remove('dragging');
                item.classList.remove('drag-over');
                document.querySelectorAll('.bookmark-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                // 移除所有占位符
                document.querySelectorAll('[data-placeholder="true"]').forEach(placeholder => {
                    placeholder.remove();
                });
                
                state.draggingBookmarkId = null;
                state.dragTargetIndex = -1;
            });
        }

        // 根据网站类型获取图标
        function getIconByWebsiteType(name, url) {
            const nameLower = name.toLowerCase();
            const urlLower = url.toLowerCase();
            
            if (nameLower.includes('搜索') || nameLower.includes('google') || nameLower.includes('百度') || nameLower.includes('bing')) {
                return 'fas fa-search icon-search';
            }
            else if (nameLower.includes('视频') || nameLower.includes('youtube') || nameLower.includes('bilibili') || nameLower.includes('优酷') || nameLower.includes('爱奇艺')) {
                return 'fas fa-film icon-video';
            }
            else if (nameLower.includes('社交') || nameLower.includes('微信') || nameLower.includes('微博') || nameLower.includes('facebook') || nameLower.includes('twitter')) {
                return 'fab fa-weixin icon-social';
            }
            else if (nameLower.includes('购物') || nameLower.includes('淘宝') || nameLower.includes('京东') || nameLower.includes('amazon') || nameLower.includes('shop')) {
                return 'fas fa-shopping-cart icon-shopping';
            }
            else if (nameLower.includes('旅行') || nameLower.includes('机票') || nameLower.includes('酒店') || nameLower.includes('携程') || nameLower.includes('trip')) {
                return 'fas fa-plane icon-travel';
            }
            else if (nameLower.includes('工具') || nameLower.includes('工具') || nameLower.includes('utility') || nameLower.includes('tool')) {
                return 'fas fa-wrench icon-tools';
            }
            else if (nameLower.includes('新闻') || nameLower.includes('news') || nameLower.includes('媒体')) {
                return 'fas fa-newspaper icon-news';
            }
            else if (nameLower.includes('音乐') || nameLower.includes('music') || nameLower.includes('网易云')) {
                return 'fas fa-music icon-music';
            }
            else if (nameLower.includes('游戏') || nameLower.includes('game') || nameLower.includes('play')) {
                return 'fas fa-gamepad icon-games';
            }
            else if (nameLower.includes('工作') || nameLower.includes('企业') || nameLower.includes('office') || nameLower.includes('工作')) {
                return 'fas fa-briefcase icon-work';
            }
            else {
                const randomIndex = Math.floor(Math.random() * state.defaultIcons.length);
                return state.defaultIcons[randomIndex].class;
            }
        }

        // 设置活动分类
        function setActiveCategory(categoryId, initialLoad = false) {
            state.currentCategory = categoryId;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                if (parseInt(btn.dataset.id) === categoryId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.bookmarks-section').forEach(section => {
                if (section.id === `category-${categoryId}`) {
                    section.classList.add('active');
                    section.style.display = 'block';
                } else {
                    section.classList.remove('active');
                    section.style.display = 'none';
                }
            });
        }

        // 应用设置
        function applySettings() {
            const settings = state.settings;
            
            if (settings.backgroundType === 'gradient') {
                document.body.style.background = settings.backgroundValue;
                elements.backgroundImage.style.display = 'none';
                document.body.classList.remove('no-texture');
            } else if (settings.backgroundType === 'image') {
                document.body.style.background = '';
                elements.backgroundImage.src = settings.backgroundValue;
                elements.backgroundImage.style.display = 'block';
                document.body.classList.add('no-texture');
            }
            
            document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
            document.documentElement.style.setProperty('--secondary-color', settings.secondaryColor);
            document.documentElement.style.setProperty('--bg-color', settings.backgroundValue);
            document.documentElement.style.setProperty('--text-color', settings.textColor);
            document.documentElement.style.setProperty('--category-color', settings.categoryColor);
            document.documentElement.style.setProperty('--bookmark-color', settings.bookmarkColor);
            document.documentElement.style.setProperty('--title-font', settings.pageTitleFont);
            document.documentElement.style.setProperty('--subtitle-font', settings.pageSubtitleFont);
            
            if (settings.pageTitle) {
                elements.pageTitle.textContent = settings.pageTitle;
                elements.pageTitle.style.fontSize = settings.pageTitleFontSize;
                elements.pageTitle.style.fontFamily = settings.pageTitleFont;
                
                if (settings.pageTitleIcon) {
                    const existingIcon = elements.pageTitle.querySelector('.page-title-icon');
                    if (existingIcon) {
                        existingIcon.remove();
                    }
                    
                    const icon = document.createElement('img');
                    icon.className = 'page-title-icon';
                    icon.src = settings.pageTitleIcon;
                    icon.alt = '标题图标';
                    elements.pageTitle.prepend(icon);
                    
                    const fontSize = parseInt(settings.pageTitleFontSize);
                    icon.style.width = `${fontSize * 1.2}px`;
                    icon.style.height = `${fontSize * 1.2}px`;
                } else {
                    const existingIcon = elements.pageTitle.querySelector('.page-title-icon');
                    if (existingIcon) {
                        existingIcon.remove();
                    }
                }
            } else {
                elements.pageTitle.textContent = '';
            }
            
            if (settings.pageSubtitle) {
                elements.pageSubtitle.textContent = settings.pageSubtitle;
                elements.pageSubtitle.style.fontSize = settings.pageSubtitleFontSize;
                elements.pageSubtitle.style.fontFamily = settings.pageSubtitleFont;
            } else {
                elements.pageSubtitle.textContent = '';
            }
        }

        // 更新搜索引擎显示
        function updateSearchEngineDisplay() {
            const engine = state.searchEngines[state.settings.searchEngine];
            if (engine) {
                if (engine.icon === 'baidu-icon') {
                    elements.currentEngine.innerHTML = `
                        <div class="baidu-icon"></div>
                        <span class="engine-name" style="display: none;">${engine.name}</span>
                    `;
                } else {
                    elements.currentEngine.innerHTML = `
                        <i class="${engine.icon}" style="font-size: 26px;"></i>
                        <span class="engine-name" style="display: none;">${engine.name}</span>
                    `;
                }
                elements.currentEngine.title = engine.name;
            }
        }

        // 更新搜索功能状态
        function updateSearchFunctionState() {
            if (state.editMode) {
                elements.searchInput.classList.add('disabled');
                elements.searchInput.disabled = true;
                elements.searchBtn.classList.add('disabled');
                elements.imageSearchBtn.classList.add('disabled');
                elements.currentEngine.style.opacity = '0.5';
                elements.currentEngine.style.cursor = 'not-allowed';
                elements.currentEngine.style.pointerEvents = 'none';
            } else {
                elements.searchInput.classList.remove('disabled');
                elements.searchInput.disabled = false;
                elements.searchBtn.classList.remove('disabled');
                elements.imageSearchBtn.classList.remove('disabled');
                elements.currentEngine.style.opacity = '1';
                elements.currentEngine.style.cursor = 'pointer';
                elements.currentEngine.style.pointerEvents = 'auto';
            }
        }

        // 打开图片搜索模态框
        function openImageSearchModal() {
            state.imageSearch = {
                selectedEngine: state.settings.imageSearchEngine || 'baidu',
                uploadedImage: null,
                imageUrl: '',
                imageFile: null
            };
            
            elements.imagePreview.style.display = 'none';
            elements.imagePreview.src = '';
            elements.imageUrlInput.value = '';
            elements.imageUploadInput.value = '';
            
            elements.imageSearchEngines.querySelectorAll('.image-search-engine').forEach(item => {
                item.classList.remove('selected');
                if (item.dataset.engine === state.imageSearch.selectedEngine) {
                    item.classList.add('selected');
                }
            });
            
            updateImageSearchButtonState();
            elements.imageSearchModal.style.display = 'flex';
        }

        // 执行图片搜索
        function performImageSearch() {
            const engine = imageSearchEnginesData[state.imageSearch.selectedEngine];
            if (!engine) return;
            
            let searchUrl = engine.url;
            
            if (engine.method === 'url') {
                // 对于URL传参的搜索引擎
                if (state.imageSearch.uploadedImage) {
                    // 对于上传的图片，需要特殊处理
                    alert('该搜索引擎不支持直接上传图片，请使用百度识图或提供图片URL');
                    return;
                } else if (state.imageSearch.imageUrl.trim() !== '') {
                    searchUrl += encodeURIComponent(state.imageSearch.imageUrl);
                    window.open(searchUrl, '_blank');
                } else {
                    alert('请提供图片URL');
                    return;
                }
            } else if (engine.method === 'redirect') {
                // 对于百度识图，直接跳转
                window.open(searchUrl, '_blank');
            }
            
            closeModal(elements.imageSearchModal);
        }

        // 打开编辑书签模态框
        function openEditBookmarkModal(bookmarkId) {
            const bookmark = state.bookmarks.find(b => b.id === bookmarkId);
            if (!bookmark) return;
            
            state.editingBookmarkId = bookmarkId;
            
            const editBookmarkName = document.getElementById('editBookmarkName');
            const editBookmarkUrl = document.getElementById('editBookmarkUrl');
            
            editBookmarkName.value = bookmark.name;
            editBookmarkUrl.value = bookmark.url;
            
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
                if (bookmark.customIcon && option.dataset.icon === bookmark.customIcon) {
                    option.classList.add('selected');
                }
            });
            
            elements.editBookmarkModal.style.display = 'flex';
        }

        // 打开添加书签模态框
        function openAddBookmarkModal(categoryId) {
            state.editingBookmarkId = null;
            
            const editBookmarkName = document.getElementById('editBookmarkName');
            const editBookmarkUrl = document.getElementById('editBookmarkUrl');
            
            editBookmarkName.value = '';
            editBookmarkUrl.value = '';
            
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            state.currentCategory = categoryId;
            elements.editBookmarkModal.style.display = 'flex';
        }

        // 打开编辑分类模态框
        function openEditCategoryModal(categoryId) {
            const category = state.categories.find(c => c.id === categoryId);
            if (!category) return;
            
            state.editingCategoryId = categoryId;
            document.getElementById('editCategoryName').value = category.name;
            elements.editCategoryModal.style.display = 'flex';
        }

        // 打开添加分类模态框
        function openAddCategoryModal() {
            state.editingCategoryId = null;
            document.getElementById('addCategoryName').value = '';
            elements.addCategoryModal.style.display = 'flex';
        }

        // 删除分类
        function deleteCategory(categoryId) {
            showConfirmDialog('删除分类', '确定要删除这个分类吗？此操作会删除该分类下的所有网站！', () => {
                state.categories = state.categories.filter(c => c.id !== categoryId);
                state.bookmarks = state.bookmarks.filter(b => b.categoryId !== categoryId);
                
                if (state.currentCategory === categoryId && state.categories.length > 0) {
                    state.currentCategory = state.categories[0].id;
                } else if (state.categories.length === 0) {
                    state.currentCategory = null;
                }
                
                saveData();
                renderCategories();
                renderBookmarks();
            });
        }

        // 显示确认对话框
        function showConfirmDialog(title, message, onConfirm) {
            elements.confirmDialogTitle.textContent = title;
            elements.confirmDialogMessage.textContent = message;
            elements.confirmDialog.style.display = 'flex';
            
            elements.confirmDialogConfirmBtn.onclick = () => {
                closeModal(elements.confirmDialog);
                if (onConfirm) onConfirm();
            };
            
            elements.confirmDialogCancelBtn.onclick = () => {
                closeModal(elements.confirmDialog);
            };
        }

        // 改变每行书签数量 - 修复：基于当前行数计算
        function changeRowsPerCategory(action) {
            const currentRows = state.settings.rowsPerCategory || 4;
            
            if (action === 'add' && currentRows < 8) {
                state.settings.rowsPerCategory = currentRows + 1;
            } else if (action === 'remove' && currentRows > 1) {
                state.settings.rowsPerCategory = currentRows - 1;
            }
            
            saveData();
            renderBookmarks();
        }

        // 导入数据 - 修改为只从文件导入
        function importData() {
            const fileInput = elements.importFileInput;
            
            if (fileInput.files.length === 0) {
                showError(elements.importError, '请选择要导入的文件');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importText = event.target.result;
                    const lines = importText.split('\n');
                    const newCategories = [];
                    const newBookmarks = [];
                    let currentCategory = null;
                    let categoryId = Math.max(...state.categories.map(c => c.id), 0) + 1;
                    let bookmarkId = Math.max(...state.bookmarks.map(b => b.id), 0) + 1;
                    
                    for (const line of lines) {
                        const trimmedLine = line.trim();
                        if (!trimmedLine) continue;
                        
                        if (trimmedLine.startsWith('【') && trimmedLine.endsWith('】')) {
                            const categoryName = trimmedLine.substring(1, trimmedLine.length - 1);
                            currentCategory = {
                                id: categoryId++,
                                name: categoryName,
                                order: newCategories.length + 1
                            };
                            newCategories.push(currentCategory);
                        } else if (currentCategory && trimmedLine.includes('|')) {
                            const parts = trimmedLine.split('|').map(p => p.trim());
                            if (parts.length >= 2) {
                                const bookmarkName = parts[0];
                                let bookmarkUrl = parts[1];
                                
                                if (!bookmarkUrl.startsWith('http://') && !bookmarkUrl.startsWith('https://')) {
                                    bookmarkUrl = 'https://' + bookmarkUrl;
                                }
                                
                                newBookmarks.push({
                                    id: bookmarkId++,
                                    name: bookmarkName,
                                    url: bookmarkUrl,
                                    categoryId: currentCategory.id,
                                    order: newBookmarks.filter(b => b.categoryId === currentCategory.id).length + 1,
                                    customIcon: null
                                });
                            }
                        }
                    }
                    
                    if (state.importType === 'replace') {
                        state.categories = newCategories;
                        state.bookmarks = newBookmarks;
                        
                        if (state.categories.length > 0) {
                            state.currentCategory = state.categories[0].id;
                        }
                    } else {
                        const existingCategoryNames = state.categories.map(c => c.name.toLowerCase());
                        const categoriesToAdd = newCategories.filter(c => !existingCategoryNames.includes(c.name.toLowerCase()));
                        
                        categoriesToAdd.forEach(category => {
                            state.categories.push({
                                ...category,
                                order: state.categories.length + 1
                            });
                        });
                        
                        newBookmarks.forEach(bookmark => {
                            const targetCategory = categoriesToAdd.find(c => c.id === bookmark.categoryId);
                            if (targetCategory) {
                                const actualCategory = state.categories.find(c => c.name.toLowerCase() === targetCategory.name.toLowerCase());
                                if (actualCategory) {
                                    state.bookmarks.push({
                                        ...bookmark,
                                        categoryId: actualCategory.id,
                                        order: state.bookmarks.filter(b => b.categoryId === actualCategory.id).length + 1
                                    });
                                }
                            }
                        });
                    }
                    
                    ensureOrderFields();
                    saveData();
                    renderCategories();
                    renderBookmarks();
                    
                    closeModal(elements.importExportModal);
                    fileInput.value = '';
                    elements.importError.style.display = 'none';
                    
                    alert('数据导入成功！');
                } catch (error) {
                    console.error('导入数据失败:', error);
                    showError(elements.importError, '数据格式错误，请检查导入的文件格式');
                }
            };
            
            reader.onerror = function() {
                showError(elements.importError, '读取文件失败');
            };
            
            reader.readAsText(file);
        }

        // 导出数据
        function exportData() {
            let exportText = '';
            
            const sortedCategories = [...state.categories].sort((a, b) => a.order - b.order);
            
            sortedCategories.forEach(category => {
                exportText += `【${category.name}】\n`;
                
                const categoryBookmarks = state.bookmarks
                    .filter(bookmark => bookmark.categoryId === category.id)
                    .sort((a, b) => a.order - b.order);
                
                categoryBookmarks.forEach(bookmark => {
                    exportText += `${bookmark.name} | ${bookmark.url}\n`;
                });
                
                exportText += '\n';
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `导航页数据备份_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 显示错误信息
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        // 关闭模态框
        function closeModal(modal) {
            modal.style.display = 'none';
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 搜索引擎选择器
            elements.currentEngine.addEventListener('click', () => {
                if (state.editMode) return;
                elements.engineGrid.classList.toggle('show');
            });
            
            document.addEventListener('click', (e) => {
                if (!elements.currentEngine.contains(e.target) && !elements.engineGrid.contains(e.target)) {
                    elements.engineGrid.classList.remove('show');
                }
            });
            
            // 搜索功能
            elements.searchBtn.addEventListener('click', performSearch);
            elements.searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // 识图搜图
            elements.imageSearchBtn.addEventListener('click', openImageSearchModal);
            
            // 设置按钮 - 修复：点击时先关闭菜单
            elements.settingsBtn.addEventListener('click', toggleSettings);
            
            // 自定义模式 - 修复：点击时关闭菜单
            elements.customizeBtn.addEventListener('click', () => {
                elements.settingsMenu.classList.remove('show');
                toggleEditMode();
            });
            
            // 配色与背景
            elements.colorBgBtn.addEventListener('click', () => {
                elements.settingsMenu.classList.remove('show');
                openColorBgModal();
            });
            
            // 数据备份与恢复
            elements.importExportBtn.addEventListener('click', () => {
                elements.settingsMenu.classList.remove('show');
                elements.importExportModal.style.display = 'flex';
            });
            
            // 恢复默认
            elements.resetBtn.addEventListener('click', () => {
                elements.settingsMenu.classList.remove('show');
                resetToDefault();
            });
            
            // 关闭模态框按钮
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    closeModal(modal);
                });
            });
            
            // 点击模态框外部关闭模态框
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            });
            
            // 编辑书签表单
            document.getElementById('editBookmarkForm').addEventListener('submit', saveBookmark);
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                closeModal(elements.editBookmarkModal);
            });
            
            // 编辑分类表单
            document.getElementById('editCategoryForm').addEventListener('submit', saveCategory);
            document.getElementById('cancelCategoryEditBtn').addEventListener('click', () => {
                closeModal(elements.editCategoryModal);
            });
            
            // 添加分类表单
            document.getElementById('addCategoryForm').addEventListener('submit', addCategory);
            document.getElementById('cancelAddCategoryBtn').addEventListener('click', () => {
                closeModal(elements.addCategoryModal);
            });
            
            // 配色与背景标签页
            document.querySelectorAll('.color-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    document.querySelectorAll('.color-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    
                    document.querySelectorAll('.color-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId + 'Tab').classList.add('active');
                });
            });
            
            // 应用皮肤
            document.getElementById('applySkinBtn').addEventListener('click', applySkin);
            document.getElementById('cancelSkinBtn').addEventListener('click', () => {
                closeModal(elements.colorBgModal);
            });
            
            // 应用颜色
            document.getElementById('applyColorsBtn').addEventListener('click', applyColors);
            document.getElementById('cancelColorsBtn').addEventListener('click', () => {
                closeModal(elements.colorBgModal);
            });
            
            // 应用背景
            document.getElementById('applyBgBtn').addEventListener('click', applyBackground);
            document.getElementById('cancelBgBtn').addEventListener('click', () => {
                closeModal(elements.colorBgModal);
            });
            
            // 应用字体
            document.getElementById('applyFontsBtn').addEventListener('click', applyFonts);
            document.getElementById('cancelFontsBtn').addEventListener('click', () => {
                closeModal(elements.colorBgModal);
            });
            
            // 图片上传
            elements.imageUploadArea.addEventListener('click', () => {
                elements.imageUploadInput.click();
            });
            
            elements.imageUploadInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageFile(e.target.files[0]);
                }
            });
            
            // 图片URL输入
            elements.imageUrlInput.addEventListener('input', () => {
                state.imageSearch.imageUrl = elements.imageUrlInput.value;
                updateImageSearchButtonState();
            });
            
            // 开始图片搜索
            elements.startImageSearchBtn.addEventListener('click', performImageSearch);
            elements.cancelImageSearchBtn.addEventListener('click', () => {
                closeModal(elements.imageSearchModal);
            });
            
            // 导出数据
            elements.exportDataBtn.addEventListener('click', exportData);
            
            // 导入数据
            elements.importDataBtn.addEventListener('click', importData);
            elements.cancelImportExportBtn.addEventListener('click', () => {
                closeModal(elements.importExportModal);
            });
            
            // 文件导入
            elements.importFileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    if (file.size > 1024 * 1024) { // 限制1MB
                        showError(elements.importError, '文件太大，请选择小于1MB的文件');
                        return;
                    }
                }
            });
            
            // 标题图标上传
            elements.titleIconUpload.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        elements.titleIconPreview.src = event.target.result;
                        elements.titleIconPreview.style.display = 'block';
                        state.titleIconPreview = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // 移除标题图标
            elements.removeTitleIconBtn.addEventListener('click', () => {
                elements.titleIconPreview.src = '';
                elements.titleIconPreview.style.display = 'none';
                state.titleIconPreview = null;
                elements.titleIconUpload.value = '';
            });
            
            // 关闭图片搜索模态框
            elements.closeImageSearchModalBtn.addEventListener('click', () => {
                closeModal(elements.imageSearchModal);
            });
        }

        // 执行搜索
        function performSearch() {
            if (state.editMode) return;
            
            const query = elements.searchInput.value.trim();
            if (!query) return;
            
            if (query.includes('.') && (query.startsWith('http://') || query.startsWith('https://') || query.includes('.'))) {
                let url = query;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                window.open(url, '_blank');
            } else {
                const engine = state.searchEngines[state.settings.searchEngine];
                if (engine) {
                    window.open(engine.url + encodeURIComponent(query), '_blank');
                }
            }
            
            elements.searchInput.value = '';
        }

        // 切换设置菜单
        function toggleSettings() {
            if (state.settingsBtnMode === 'settings') {
                elements.settingsMenu.classList.toggle('show');
            } else {
                // 在确认模式下，点击对勾退出编辑模式
                exitEditMode();
            }
        }

        // 切换编辑模式
        function toggleEditMode() {
            state.editMode = !state.editMode;
            document.body.classList.toggle('edit-mode', state.editMode);
            
            if (state.editMode) {
                elements.settingsBtn.innerHTML = '<i class="fas fa-check"></i>';
                elements.settingsBtn.classList.add('confirm-mode');
                elements.settingsBtnMode = 'confirm';
                elements.settingsMenu.classList.remove('show');
                elements.dragHint.style.display = 'block';
            } else {
                exitEditMode();
            }
            
            updateSearchFunctionState();
            renderCategories();
            renderBookmarks();
        }

        // 退出编辑模式
        function exitEditMode() {
            state.editMode = false;
            document.body.classList.remove('edit-mode');
            elements.settingsBtn.innerHTML = '<i class="fas fa-cog"></i>';
            elements.settingsBtn.classList.remove('confirm-mode');
            elements.settingsBtnMode = 'settings';
            elements.dragHint.style.display = 'none';
            updateSearchFunctionState();
            renderCategories();
            renderBookmarks();
        }

        // 打开配色与背景模态框
        function openColorBgModal() {
            elements.editTitleText.value = state.settings.pageTitle || '';
            elements.editSubtitleText.value = state.settings.pageSubtitle || '';
            
            if (state.settings.pageTitleIcon) {
                elements.titleIconPreview.src = state.settings.pageTitleIcon;
                elements.titleIconPreview.style.display = 'block';
            } else {
                elements.titleIconPreview.style.display = 'none';
            }
            
            elements.settingsMenu.classList.remove('show');
            elements.colorBgModal.style.display = 'flex';
        }

        // 应用皮肤
        function applySkin() {
            if (!state.selectedSkin) {
                alert('请先选择一个皮肤');
                return;
            }
            
            state.settings.backgroundType = state.selectedSkin.bgType;
            state.settings.backgroundValue = state.selectedSkin.bgValue;
            state.settings.primaryColor = state.selectedSkin.primaryColor;
            state.settings.secondaryColor = state.selectedSkin.secondaryColor;
            state.settings.textColor = state.selectedSkin.textColor;
            state.settings.categoryColor = state.selectedSkin.categoryColor;
            state.settings.bookmarkColor = state.selectedSkin.bookmarkColor;
            
            saveData();
            applySettings();
            closeModal(elements.colorBgModal);
        }

        // 应用颜色
        function applyColors() {
            state.settings.textColor = document.getElementById('titleColorPicker').value;
            state.settings.categoryColor = document.getElementById('categoryColorPicker').value;
            state.settings.bookmarkColor = document.getElementById('bookmarkColorPicker').value;
            state.settings.primaryColor = document.getElementById('primaryColorPicker').value;
            state.settings.secondaryColor = document.getElementById('secondaryColorPicker').value;
            
            saveData();
            applySettings();
            closeModal(elements.colorBgModal);
        }

        // 应用背景
        function applyBackground() {
            const selectedBg = document.querySelector('.bg-option.selected');
            if (!selectedBg) {
                alert('请选择一个背景');
                return;
            }
            
            const bgId = selectedBg.id;
            
            if (bgId === 'imageUpload') {
                const fileInput = document.getElementById('imageUploadInput');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        state.settings.backgroundType = 'image';
                        state.settings.backgroundValue = event.target.result;
                        saveData();
                        applySettings();
                        closeModal(elements.colorBgModal);
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('请先上传一张图片');
                }
            } else {
                const bgValue = selectedBg.style.background;
                state.settings.backgroundType = 'gradient';
                state.settings.backgroundValue = bgValue;
                
                saveData();
                applySettings();
                closeModal(elements.colorBgModal);
            }
        }

        // 应用字体
        function applyFonts() {
            const titleText = elements.editTitleText.value.trim();
            const subtitleText = elements.editSubtitleText.value.trim();
            
            state.settings.pageTitle = titleText;
            state.settings.pageSubtitle = subtitleText;
            
            if (state.titleIconPreview) {
                state.settings.pageTitleIcon = state.titleIconPreview;
            } else if (elements.titleIconPreview.src) {
                state.settings.pageTitleIcon = elements.titleIconPreview.src;
            } else {
                state.settings.pageTitleIcon = '';
            }
            
            state.settings.pageTitleFontSize = elements.titleFontSize.value + 'px';
            state.settings.pageSubtitleFontSize = elements.subtitleFontSize.value + 'px';
            
            saveData();
            applySettings();
            closeModal(elements.colorBgModal);
        }

        // 保存书签
        function saveBookmark(e) {
            e.preventDefault();
            
            const name = document.getElementById('editBookmarkName').value.trim();
            const url = document.getElementById('editBookmarkUrl').value.trim();
            
            if (!name || !url) {
                alert('请填写完整信息');
                return;
            }
            
            let finalUrl = url;
            if (!finalUrl.startsWith('http://') && !finalUrl.startsWith('https://')) {
                finalUrl = 'https://' + finalUrl;
            }
            
            const selectedIcon = document.querySelector('.icon-option.selected');
            const customIcon = selectedIcon ? selectedIcon.dataset.icon : null;
            
            if (state.editingBookmarkId) {
                const bookmark = state.bookmarks.find(b => b.id === state.editingBookmarkId);
                if (bookmark) {
                    bookmark.name = name;
                    bookmark.url = finalUrl;
                    bookmark.customIcon = customIcon;
                }
            } else {
                const newId = state.bookmarks.length > 0 ? Math.max(...state.bookmarks.map(b => b.id)) + 1 : 1;
                const categoryBookmarks = state.bookmarks.filter(b => b.categoryId === state.currentCategory);
                const newOrder = categoryBookmarks.length + 1;
                
                state.bookmarks.push({
                    id: newId,
                    name,
                    url: finalUrl,
                    categoryId: state.currentCategory,
                    order: newOrder,
                    customIcon
                });
            }
            
            saveData();
            renderBookmarks();
            closeModal(elements.editBookmarkModal);
        }

        // 保存分类
        function saveCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('editCategoryName').value.trim();
            if (!name) {
                alert('请输入分类名称');
                return;
            }
            
            const category = state.categories.find(c => c.id === state.editingCategoryId);
            if (category) {
                category.name = name;
            }
            
            saveData();
            renderCategories();
            closeModal(elements.editCategoryModal);
        }

        // 添加分类
        function addCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('addCategoryName').value.trim();
            if (!name) {
                alert('请输入分类名称');
                return;
            }
            
            const newId = state.categories.length > 0 ? Math.max(...state.categories.map(c => c.id)) + 1 : 1;
            const newOrder = state.categories.length + 1;
            
            state.categories.push({
                id: newId,
                name,
                order: newOrder
            });
            
            saveData();
            renderCategories();
            closeModal(elements.addCategoryModal);
        }

        // 恢复默认设置
        function resetToDefault() {
            showConfirmDialog('恢复默认设置', '确定要恢复默认设置吗？此操作会清空所有自定义设置和数据！', () => {
                localStorage.removeItem('navPageData');
                state.categories = [...initialData.categories];
                state.bookmarks = [...initialData.bookmarks];
                state.settings = {...initialData.settings};
                
                if (state.categories.length > 0) {
                    state.currentCategory = state.categories[0].id;
                }
                
                ensureSettings();
                saveData();
                renderCategories();
                renderBookmarks();
                applySettings();
                updateSearchEngineDisplay();
                
                elements.settingsMenu.classList.remove('show');
            });
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>